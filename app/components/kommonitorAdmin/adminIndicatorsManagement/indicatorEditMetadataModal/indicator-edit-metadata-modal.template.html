<div class="modal fade" id="modal-edit-indicator-metadata" role="dialog">
	<div class="modal-dialog modal-xl">
		<div class="modal-content">

			<div align="center">
				<div class="loading-overlay-admin-panel ng-hide" ng-show="loadingData">
					<span class="glyphicon glyphicon-refresh icon-spin"></span>
				</div>
			</div>


			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">Metadaten des Indikators
					<i><b>{{currentIndicatorDataset.indicatorName}}</b></i> editieren</h4>
			</div>
			<div class="modal-body">

				<!-- {
						"refrencesToOtherIndicators": [
							{
							"referenceDescription": "referenceDescription",
							"indicatorId": "indicatorId"
							},
							{
							"referenceDescription": "referenceDescription",
							"indicatorId": "indicatorId"
							}
						],
						"metadata": {
							"note": "note",
							"literature": "literature",
							"updateInterval": "ARBITRARY",
							"sridEPSG": 0.8008281904610115,
							"datasource": "datasource",
							"contact": "contact",
							"lastUpdate": "2000-01-23",
							"description": "description",
							"databasis": "databasis"
						},
						"allowedRoles": [
							"allowedRoles",
							"allowedRoles"
						],
						"datasetName": "datasetName",
						"applicableSpatialUnit": "applicableSpatialUnit",
						"abbreviation": "abbreviation",
						"characteristicValue": "characteristicValue",
						"tags": [
							"tags",
							"tags"
						],
						"creationType": "INSERTION",
						"unit": "unit",
						"topicReference": "topicReference",
						"refrencesToGeoresources": [
							{
							"referenceDescription": "referenceDescription",
							"georesourceId": "georesourceId"
							},
							{
							"referenceDescription": "referenceDescription",
							"georesourceId": "georesourceId"
							}
						],
						"indicatorType": "STATUS_ABSOLUTE",
						"interpretation": "interpretation",
						"isHeadlineIndicator": false,
						"processDescription": "processDescription",
						"lowestSpatialUnitForComputation": "lowestSpatialUnitForComputation",
						"defaultClassificationMapping": {
							"colorBrewerSchemeName": "colorBrewerSchemeName",
							"items": [
							{
								"defaultCustomRating": "defaultCustomRating",
								"defaultColorAsHex": "defaultColorAsHex"
							},
							{
								"defaultCustomRating": "defaultCustomRating",
								"defaultColorAsHex": "defaultColorAsHex"
							}
							]
						}
						}
			 -->

				<!-- MultiStep Form -->
				<div class="row">
					<div class="col-md-12">
						<form class="multiStepForm form-group" id="indicatorEditMetadataForm" role="form"
							data-toggle="validator" data-disable="true" style="margin-bottom: 0px;">
							<!-- progressbar -->
							<div ng-if="$ctrl.kommonitorDataExchangeServiceInstance.enableKeycloakSecurity">
								<ul id="progressbar">
									<li style="width: 16.66%;" class="active">Metadaten des Indikators</li>
									<li style="width: 16.66%;" >Allgemeine Metadaten</li>
									<li style="width: 16.66%;">Themenhierarchie</li>
									<li style="width: 16.66%;">Referenzen zu Indikatoren/Georessourcen</li>
									<li style="width: 16.66%;">Klassifizierungsoptionen</li>
									<li style="width: 16.66%">Rollenbasierter Zugriffsschutz</li>
								</ul>
							</div>
							<div ng-if="! $ctrl.kommonitorDataExchangeServiceInstance.enableKeycloakSecurity">
								<ul id="progressbar">
									<li style="width: 20%;" class="active">Metadaten des Indikators</li>
									<li style="width: 20%;" >Allgemeine Metadaten</li>
									<li style="width: 20%;">Themenhierarchie</li>
									<li style="width: 20%;">Referenzen zu Indikatoren/Georessourcen</li>
									<li style="width: 20%;">Klassifizierungsoptionen</li>
								</ul>
							</div>
							
							<!-- fieldsets -->
							
							<fieldset>
								<h2 class="fs-title">Metadaten des Indikators</h2>
								<h3 class="fs-subtitle">Angaben &uuml;ber Metadaten des Indikators</h3>
								<p><b><i>* = Pflichtfeld</i></b></p>

								<div class="row vertical-align">
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Indikatorname*</label>
											<input type="text" class="form-control" ng-model="datasetName"
												ng-change="checkDatasetName()"
												placeholder="Name" required></input>
											<div class="help-block with-errors"></div>
											<div class="help-block">
												<p>Das Tupel aus 'Indikatorname' und 'Indikatoren-Typ' muss eindeutig sein.</p>
												
											</div>
											<div ng-if="datasetNameInvalid" style="color: red;">
												<p>Umbenennung ung&uuml;ltig. Es existiert bereits ein weiterer Indikator mit
													gleichem Namen und gleichem Typ.</p>
											</div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>K&uuml;rzel/Kennzeichen</label>
											<input type="text" class="form-control" ng-model="indicatorAbbreviation"
												placeholder="optionales K&uuml;rzel"></input>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Indikatoren-Typ*</label>
											<select ng-model="indicatorType"
												ng-options="type as type.displayName for type in $ctrl.kommonitorDataExchangeServiceInstance.indicatorTypeOptions"
												ng-init="indicatorType = $ctrl.kommonitorDataExchangeServiceInstance.indicatorTypeOptions[0]"
												ng-change="checkDatasetName()"
												class="form-control" required>
												<option disabled selected value> -- Indikatorentyp w&auml;hlen --
												</option>
											</select>
											<div class="help-block with-errors"></div>
											<div class="help-block">
												<p>'Status'-Indikatoren enthalten Werte für je einen einzelnen Zeitpunkt.</p>
												<p>'Dynamik'-Indikatoren enthalten Werte, die sich auf eine Zeitperiode beziehen (bspw. Ver&auml;nderung innerhalb der letzten 5 Jahre), somit Zu- oder Abnahmen des Indikators.
												</p>
											</div>
										</div>

									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<!-- we hide characteristicValue parameter as it is and old relic not used any longer. 
										-> deprecated -->
										
										<!-- <div class="form-group">
											<label>Merkmalsauspr&auml;gung</label>
											<input type="text" class="form-control" ng-model="indicatorCharacteristicValue"
												placeholder="optionale Merkmalsauspr&auml;gung"></input>
											
											<div class="help-block">
												<p>Angabe, wenn mehrere Indikatoren mit gleichen Namen, aber unterschiedlichen Merkmals angelegt werden sollen 
													(bspw. Einwohnerzahl männlich, Einwohnerzahl weiblich, Einwohnerzahl diverse)</p>
											</div>	
											<div class="help-block with-errors"></div>
										</div> -->
									</div>
								</div>

								<div class="row vertical-align">
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Einheit*</label>
											<select ng-model="indicatorUnit"	ng-change="onChangeIndicatorUnit()"											
												class="form-control" required>
												<option disabled selected value> -- Einheit w&auml;hlen -- </option>
												<option>-- Freitext --</option>
												<option ng-repeat="unit in $ctrl.kommonitorDataExchangeServiceInstance.indicatorUnitOptions">{{unit}}</option>
												
											</select>
											<div ng-hide="! enableFreeTextUnit">
												<label>Freitexteingabe*</label>
												<input type="text"  class="form-control" ng-model="indicatorUnit"
												placeholder="Einheit" required></input>
											</div>
											
											<div class="help-block">
												<p>Enth&auml;lt die Auswahlliste nicht das gew&uuml;nschte Element, dann '-- Freitext --' selektieren, um einen Freitext einzugeben</p>
											</div>	
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Methodik (der Berechnung)</label>
											<textarea rows="3" type="text" class="form-control" ng-model="indicatorProcessDescription"
												placeholder="optionale Methodik"></textarea>

											<div class="help-block">
												<p>Hinweise &uuml;ber die Berechnungsvorschrift des Indikators</p>
											</div>		
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Interpretation*</label>
											<textarea rows="3" class="form-control" ng-model="indicatorInterpretation"
												placeholder="optionale Interpretationshilfe" required></textarea>
											<div class="help-block">
												<p>Hinweise, um die Verst&auml;ndlichkeit der Werteverteiung des Indikators zu erh&ouml;hen</p>
											</div>		
											<div class="help-block with-errors"></div>
										</div>
									</div>									
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Tags (Komma-separierte Auflistung)</label>
											<input type="text" class="form-control" ng-model="indicatorTagsString_withCommas"
												placeholder="optionale Komma-separierte Tags"></input>
											
											<div class="help-block">
												<p>Eingabe als Freitext. Komma dient als Trennzeichen</p>
											</div>		
											<div class="help-block with-errors"></div>
										</div>
									</div>
								</div>

								<div class="row vertical-align">
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Leitindikator*</label>		
											<label class="switch">
												<input type="checkbox" value="isHeadlineIndicator" ng-model="isHeadlineIndicator">
												<span class="switchslider round"></span>
											</label>	
										
											<div class="help-block">
												<p>Angabe, ob der Indikator ein Leitindikator ist. Leitindikatoren aggregieren in der Regel Basisindikatoren zu einer h&ouml;herwertigen Aussage</p>
											</div>	
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Hinweistext zu Referenzdatum</label>
											<textarea rows="3" class="form-control" ng-model="indicatorReferenceDateNote"
												placeholder="optionaler Hinweistext bzgl. Referenzdatum des Indikators"></textarea>
											<div class="help-block">
												<p>Angabe des Referenzdatums oder Hinweise &uuml;ber die Fortf&uuml;hrung des Indikators</p>
											</div>		
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Fortf&uuml;hrungstyp*</label>
											<select ng-model="indicatorCreationType" ng-change="onChangeCreationType()"
												ng-options="type as type.displayName for type in $ctrl.kommonitorDataExchangeServiceInstance.indicatorCreationTypeOptions"
												ng-init="indicatorCreationType = $ctrl.kommonitorDataExchangeServiceInstance.indicatorCreationTypeOptions[0]"
												class="form-control" required>
												<option disabled selected value> -- Fortf&uuml;hrungstyp w&auml;hlen --
												</option>
											</select>

											<div class="help-block">
												<p>'manuell' bedeutet, dass die Zeitreihenfortf&uuml;hrung manuell durch den Anwender durchgef&uuml;hrt werden muss.</p>
												<p>'automatisierte Berechnung durch KomMonitor' bedeutet, dass die Zeitreihenfortf&uuml;hrung mittels eines Skript-Mechanismus 
													semi-automatisiert von KomMonitor durchgef&uuml;hrt werden kann.
												</p>
											</div>	
											<div class="help-block with-errors"></div>
										</div>
									</div>
									
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div ng-show="enableLowestSpatialUnitSelect" class="form-group">
											<label>Niedrigste Raumebene für automatisierte Berechnung</label>
											<select ng-model="indicatorLowestSpatialUnitMetadataObjectForComputation"
												ng-options="spatialUnit as spatialUnit.spatialUnitLevel for spatialUnit in $ctrl.kommonitorDataExchangeServiceInstance.availableSpatialUnits"																							
												class="form-control">
												<option disabled selected value> -- Raumeinheit w&auml;hlen --
												</option>
											</select>

											<div class="help-block">
												<p>Angabe der niedrigsten Raumebene, für die der automatisiert berechenbare Indikator berechnet werden kann. 
													Indikatorenwerte für h&ouml;here Raumebenen werden dabei automatisch aus den niedrigeren Ebenen aggregiert berechnet.</p>
											</div>	
											<div class="help-block with-errors"></div>
										</div>
									</div>								
								</div>

								<input type="button" name="next" class="next next_editIndicatorMetadata action-button" value="N&auml;chster Schritt"/>

							</fieldset>

							<fieldset>
								<h2 class="fs-title">Allgemeine Metadaten</h2>
								<h3 class="fs-subtitle">Angaben &uuml;ber allgemeine Metadaten in KomMonitor</h3>
								<p><b><i>* = Pflichtfeld</i></b></p>

								<div class="row vertical-align">
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Beschreibung*</label>
											<textarea rows="3" class="form-control" ng-model="metadata.description"
												placeholder="Datensatz Beschreibung" required></textarea>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Datenbasis</label>
											<textarea rows="3" class="form-control" ng-model="metadata.databasis"
												placeholder="optionale Beschreibung etwaiger grundlegender Daten, die zur Erzeugung des Datensatzes beitragen"></textarea>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Datenquelle*</label>
											<textarea rows="3" class="form-control" ng-model="metadata.datasource"
												placeholder="Beschreibung der Datenquelle" required></textarea>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Datenhalter und Kontakt*</label>
											<textarea rows="3" class="form-control" ng-model="metadata.contact"
												placeholder="Beschreibung des Datenhalters und etwaiger Kontaktinformationen"
												required></textarea>
											<div class="help-block with-errors"></div>
										</div>
									</div>
								</div>

								<div class="row vertical-align">
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Aktualisierungszyklus*</label>
											<select ng-model="metadata.updateInterval"
												ng-options="value as value.displayName for value in $ctrl.kommonitorDataExchangeServiceInstance.updateIntervalOptions"
												class="form-control" required>
												<option disabled selected value> -- Aktualisierungszyklus w&auml;hlen --
												</option>
											</select>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Datum der letzten Aktualisierung*</label>
											<div class="input-group date">
												<div class="input-group-addon">
													<i class="far fa-calendar-alt"></i>
												</div>
												<input type="text" ng-model="metadata.lastUpdate"
													class="form-control pull-right" placeholder="YYYY-MM-DD"
													id="indicatorEditLastUpdateDatepicker" required>
											</div>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Literatur</label>
											<textarea rows="3" class="form-control" ng-model="metadata.literature"
												placeholder="optionale Angaben zu Literatur"></textarea>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Bemerkung</label>
											<textarea rows="3" class="form-control" ng-model="metadata.note"
												placeholder="optionale Bemerkung"></textarea>
											<div class="help-block with-errors"></div>
										</div>
									</div>
								</div>
								
								<input type="button" name="previous" class="previous previous_editIndicatorMetadata action-button-previous" value="Voriger Schritt"/>
								<input type="button" name="next" class="next next_editIndicatorMetadata action-button" value="N&auml;chster Schritt"/>
							</fieldset>


							<fieldset>
								<h2 class="fs-title">Themenhierarchie</h2>
								<h3 class="fs-subtitle">Angaben &uuml;ber die Themenhierarchie des Indikators</h3>								

								<p><b><i>* = Pflichtfeld</i></b></p>
								<p>Angabe der Themenhierarchie. Mindestens das Hauptthema muss gew&auml;hlt werden. Vorhandene Unterthemen erscheinen nach Auswahl eines Hauptthemas. Bis zu vier Themen-Ebenen sind erlaubt.</p>

								<p>Das Aufklappen der unteren Box erm&ouml;glicht die Verwaltung des Themenkatalogs.</p>

								<div class="row vertical-align">
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div class="form-group">
											<label>Hauptthema*</label>
											<select ng-model="indicatorTopic_mainTopic"
												ng-options="mainTopic as mainTopic.topicName for mainTopic in $ctrl.kommonitorDataExchangeServiceInstance.availableTopics"
												class="form-control" required>
												<option disabled selected value> -- Hauptthema w&auml;hlen --
												</option>
											</select>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div ng-show="indicatorTopic_mainTopic.subTopics.length > 0" class="form-group">
											<label>Unterthema - erste Ebene</label>
											<select ng-model="indicatorTopic_subTopic"
												ng-options="subTopic as subTopic.topicName for subTopic in indicatorTopic_mainTopic.subTopics"
												class="form-control" >
												<option disabled selected value> -- Unterthema w&auml;hlen --
												</option>
											</select>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div ng-show="indicatorTopic_subTopic.subTopics.length > 0" class="form-group">
											<label>Unterthema - zweite Ebene</label>
											<select ng-model="indicatorTopic_subsubTopic"
												ng-options="subsubTopic as subsubTopic.topicName for subsubTopic in indicatorTopic_subTopic.subTopics"
												class="form-control" >
												<option disabled selected value> -- Unterthema w&auml;hlen --
												</option>
											</select>
											<div class="help-block with-errors"></div>
										</div>
									</div>
									<div class="col-md-3 col-sm-6 col-xs-12">
										<div ng-show="indicatorTopic_subsubTopic.subTopics.length > 0" class="form-group">
											<label>Unterthema - zweite Ebene</label>
											<select ng-model="indicatorTopic_subsubsubTopic"
												ng-options="subsubsubTopic as subsubsubTopic.topicName for subsubsubTopic in indicatorTopic_subsubTopic.subTopics"
												class="form-control" >
												<option disabled selected value> -- Unterthema w&auml;hlen --
												</option>
											</select>
											<div class="help-block with-errors"></div>
										</div>
									</div>
								</div>

								<hr>

								<br/>

								<div class="row vertical-align" ng-if="$ctrl.kommonitorDataExchangeServiceInstance.checkAdminPermission()">
									<div class="col-md-10 col-sm-12 col-xs-12">
										<div style="text-align: left;">
											<div id="indicatorEditAdmin_topicsManagement" class="box box-primary collapsed-box" style="background: #ebf0fd;">
												<div class="box-header">
												  <h3 class="box-title">Themenkatalog</h3>

													<div class="box-tools pull-right">
														<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
														</button>
													</div>
												</div>
												<!-- /.box-header -->
												<div class="box-body">

													<style>
														#indicatorEditAdmin_topicsManagement #georesourceTopicsManagement{
															display: none;
														}
													</style>

													<admin-topics-management></admin-topics-management>
												</div>
												<!-- /.box-body -->
											  </div>
											  <!-- /.box -->

										</div>
									</div>
								</div>
								

								<input type="button" name="previous" class="previous previous_editIndicatorMetadata action-button-previous" value="Voriger Schritt"/>
								<input type="button" name="next" class="next next_editIndicatorMetadata action-button" value="N&auml;chster Schritt"/>

							</fieldset>

							<fieldset>
								<h2 class="fs-title">Referenzen zu Indikatoren/Georessourcen (optional)</h2>
								<h3 class="fs-subtitle">Angaben &uuml;ber Referenzen des Indikators auf andere Indikatoren oder Georessourcen</h3>
								<!-- <p><b><i>* = Pflichtfeld</i></b></p> -->

								<p>Hier werden Angaben &uuml;ber assoziierte Indikatoren und Georessourcen get&auml;tigt. Sie eignen sich dazu, im System Querverbindungen 
									zwischen Indikatoren und Georessourcen darzustellen und dem Nutzer so die M&ouml;glichkeit zu geben, einen Themenkomplex, 
									der durch mehrere Datens&auml;tze abgebildet wird, besser zu verstehen.</p>

								<div class="row vertical-align">
									<div class="col-md-10 col-sm-12 col-xs-12">
										<!-- <div style="text-align: left;"> -->
											<div class="box box-danger collapsed-box" style="background: #ebf0fd;">
												<div class="box-header">
												  <h3 class="box-title">Referenzen zu anderen Indikatoren</h3>

													<div class="box-tools pull-right">
														<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
														</button>
													</div>
												</div>
												<!-- /.box-header -->
												<div class="box-body">

													<!-- Inputs for new reference -->

													<div class="row vertical-align">
														<div class="col-md-12 col-sm-12 col-xs-12">					
															<div class="form-group">
																<label>Indikator, f&uuml;r den eine Referenz angelegt werden soll</label>
																<div class="input-group">
																	<span class="input-group-addon"><i class="fas fa-filter"></i></span>
																	<input type="text" class="form-control input-sm" placeholder="Stichwortfilter" ng-model="indicatorNameFilter" ng-model-options="{debounce: 500, blur: 0}">
																  </div>
																  <br/>
																<select ng-model="tmpIndicatorReference_selectedIndicatorMetadata" size="5"
																	ng-options="indicatorMetadata as indicatorMetadata.indicatorName for indicatorMetadata in $ctrl.kommonitorDataExchangeServiceInstance.availableIndicators | filter:indicatorNameFilter"
																	class="form-control" >
																	<option disabled selected value> -- referenzierten Indikator w&auml;hlen --
																	</option>
																</select>
																<div class="help-block with-errors"></div>
															</div>
														</div>
													</div>

													<div class="row vertical-align">
														<div class="col-md-3 col-sm-6 col-xs-12">
															<div class="form-group">
																<label>ID des selektierten Indikators</label>
																<input type="text" class="form-control input-sm" disabled placeholder="IndikatorenId" ng-model="tmpIndicatorReference_selectedIndicatorMetadata.indicatorId">
																<div class="help-block with-errors"></div>
															</div>
														</div>
														<div class="col-md-3 col-sm-6 col-xs-12">												
															<div class="form-group">
																<label>Name des selektierten Indikators</label>
																<input type="text" class="form-control input-sm" disabled placeholder="IndikatorenName" ng-model="tmpIndicatorReference_selectedIndicatorMetadata.indicatorName">
																<div class="help-block with-errors"></div>
															</div>
														</div>
														<div class="col-md-6 col-sm-6 col-xs-12">
															<div class="form-group">
																<label>Beschreibung der Indikatoren-Referenz</label>
																<textarea rows="3" class="form-control input-sm" placeholder="Beschreibung der Referenz" ng-model="tmpIndicatorReference_referenceDescription"></textarea>
																<div class="help-block with-errors"></div>
															</div>
														</div>		
													</div>

													<div class="row vertical-align">														
														<div class="col-md-3 col-sm-6 col-xs-12">
															<div class="form-group">
																<button class="btn btn-success btn-sm" ng-disabled="!tmpIndicatorReference_selectedIndicatorMetadata && tmpIndicatorReference_referenceDescription" ng-click="onAddOrUpdateIndicatorReference()">Hinzuf&uuml;gen/Editieren</button>
																<div class="help-block with-errors"></div>
															</div>
														</div>
													</div>

													<br/>
													<br/>
					
													<!-- Table to display currently specified references -->
													<div class="row vertical-align">
														<div class="col-md-12 col-sm-12 col-xs-12">
															<label>&Uuml;bersicht der definierten Indikatoren-Referenzen</label>
															<table class="table table-condensed">
																<thead>
																	<tr>
																		<th>Editierfunktionen</th>
																		<th>ID des Indikators</th>
																		<th>Name des Indikators</th>
																		<th>K&uuml;rzel/Kennziffer</th>
																		<th>Beschreibung der Verkn&uuml;pfung</th>
																	</tr>
																</thead>
																<tbody>
																	<tr ng-repeat="indicatorReference in indicatorReferences_adminView">
																		<td>
																			<div class="btn-group btn-group-sm">
																				<button class="btn btn-warning btn-sm" type="button" ng-click="onClickEditIndicatorReference(indicatorReference)"
																					title="Referenz editieren"><i class="fas fa-pencil-alt"></i></button>
																				<button class="btn btn-danger btn-sm" type="button" ng-click="onClickDeleteIndicatorReference(indicatorReference)"
																					title="Referenz l&ouml;schen"><i class="fas fa-trash"></i></button>
																				<!-- <button class="btn btn-danger btn-sm" type="button" data-toggle="modal" data-target="#modal-delete-spatial-units" ng-click="onClickDeleteDatasets(indicatorDataset)" title="Datensatz l&ouml;schen"><i class="fas fa-trash"></i></button> -->
																			</div>
																		</td>
																		<td>{{indicatorReference.referencedIndicatorId}}</td>
																		<td>{{indicatorReference.referencedIndicatorName}}</td>
																		<td>{{indicatorReference.referencedIndicatorAbbreviation}}</td>
																		<td>{{indicatorReference.referencedIndicatorDescription}}</td>
																	</tr>
																</tbody>
															</table>
														</div>
													</div>


												</div>
												<!-- Box Body -->
											</div>	
											<!-- Box -->

										<!-- </div>	 -->

									</div>

								</div>

								<div class="row vertical-align">
									<div class="col-md-10 col-sm-12 col-xs-12">
										<!-- <div style="text-align: left;"> -->
											<div class="box box-danger collapsed-box" style="background: #ebf0fd;">
												<div class="box-header">
												  <h3 class="box-title">Referenzen zu Georessourcen</h3>

													<div class="box-tools pull-right">
														<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
														</button>
													</div>
												</div>
												<!-- /.box-header -->
												<div class="box-body">

													<!-- Inputs for new reference -->

													<div class="row vertical-align">
														<div class="col-md-12 col-sm-12 col-xs-12">
															<div class="form-group">
																<label>Indikator, f&uuml;r den eine Referenz angelegt werden soll</label>
																<div class="input-group">
																	<span class="input-group-addon"><i class="fas fa-filter"></i></span>
																	<input type="text" class="form-control input-sm" placeholder="Stichwortfilter" ng-model="georesourceNameFilter" ng-model-options="{debounce: 500, blur: 0}">
																  </div>
																  <br/>
																<select ng-model="tmpGeoresourceReference_selectedGeoresourceMetadata" size="5"
																	ng-options="georesourceMetadata as georesourceMetadata.datasetName for georesourceMetadata in $ctrl.kommonitorDataExchangeServiceInstance.availableGeoresources | filter:georesourceNameFilter"
																	class="form-control" >
																	<option disabled selected value> -- referenzierte Georessource w&auml;hlen --
																	</option>
																</select>
																<div class="help-block with-errors"></div>
															</div>
														</div>
													</div>

													<div class="row vertical-align">
														<div class="col-md-3 col-sm-6 col-xs-12">
															<div class="form-group">
																<label>ID der selektierten Georessource</label>
																<input type="text" class="form-control input-sm" disabled placeholder="Georessourcen-Id" ng-model="tmpGeoresourceReference_selectedGeoresourceMetadata.georesourceId">
																<div class="help-block with-errors"></div>
															</div>
														</div>
														<div class="col-md-3 col-sm-6 col-xs-12">												
															<div class="form-group">
																<label>Name der selektierten Georessource</label>
																<input type="text" class="form-control input-sm" disabled placeholder="Georessourcen-Name" ng-model="tmpGeoresourceReference_selectedGeoresourceMetadata.datasetName">
																<div class="help-block with-errors"></div>
															</div>
														</div>
														<div class="col-md-6 col-sm-6 col-xs-12">
															<div class="form-group">
																<label>Beschreibung der Georessourcen-Referenz</label>
																<textarea rows="3" class="form-control input-sm" placeholder="Beschreibung der Referenz" ng-model="tmpGeoresourceReference_referenceDescription"></textarea>
																<div class="help-block with-errors"></div>
															</div>
														</div>
													</div>

													<div class="row vertical-align">
														<div class="col-md-3 col-sm-6 col-xs-12">
															<div class="form-group">
																<button class="btn btn-success btn-sm" ng-disabled="!tmpGeoresourceReference_selectedGeoresourceMetadata && tmpGeoresourceReference_referenceDescription" ng-click="onAddOrUpdateGeoresourceReference()">Hinzuf&uuml;gen/Editieren</button>
																<div class="help-block with-errors"></div>
															</div>
														</div>
													</div>

													<br/>
													<br/>
					
													<!-- Table to display currently specified references -->
													<div class="row vertical-align">
														<div class="col-md-12 col-sm-12 col-xs-12">
															<label>&Uuml;bersicht der definierten Indikatoren-Referenzen</label>
															<table class="table table-condensed">
																<thead>
																	<tr>
																		<th>Editierfunktionen</th>
																		<th>ID der Georessource</th>
																		<th>Name der Georessource</th>
																		<th>Beschreibung der Verkn&uuml;pfung</th>
																	</tr>
																</thead>
																<tbody>
																	<tr ng-repeat="georesourceReference in georesourceReferences_adminView">
																		<td>
																			<div class="btn-group btn-group-sm">
																				<button class="btn btn-warning btn-sm" type="button" ng-click="onClickEditGeoresourceReference(georesourceReference)"
																					title="Referenz editieren"><i class="fas fa-pencil-alt"></i></button>
																				<button class="btn btn-danger btn-sm" type="button" ng-click="onClickDeleteGeoresourceReference(georesourceReference)"
																					title="Referenz l&ouml;schen"><i class="fas fa-trash"></i></button>
																			</div>
																		</td>
																		<td>{{georesourceReference.referencedGeoresourceId}}</td>
																		<td>{{georesourceReference.referencedGeoresourceName}}</td>
																		<td>{{georesourceReference.referencedGeoresourceDescription}}</td>
																	</tr>
																</tbody>
															</table>
														</div>
													</div>


												</div>
												<!-- Box Body -->
											</div>	
											<!-- Box -->

										<!-- </div>	 -->

									</div>

								</div>


								<input type="button" name="previous" class="previous previous_editIndicatorMetadata action-button-previous" value="Voriger Schritt"/>
								<input type="button" name="next" class="next next_editIndicatorMetadata action-button" value="N&auml;chster Schritt"/>

							</fieldset>

							<fieldset>
								<h2 class="fs-title">Klassifizierungsoptionen</h2>

								<div ng-show="indicatorType.apiName.includes('STATUS')">
									<h3 class="fs-subtitle">Angaben &uuml;ber die Standard-Klassifizierung des Indikators</h3>
									<p><b><i>* = Pflichtfeld</i></b></p>

									<div class="row vertical-align">
										<!-- <div class="col-md-5 col-sm-6 col-xs-12">
											<div class="form-group">
												<label>Anzahl Klassen*</label>
												<select ng-model="numClasses"											
													class="form-control" required>
													<option disabled selected value> -- Anzahl Klassen w&auml;hlen -- </option>
													<option ng-repeat="numClassesEntry in numClassesArray">{{numClassesEntry}}</option>
												</select>
												<div class="help-block with-errors"></div>
											</div>
										</div> -->
										<div class="col-md-4 col-sm-6 col-xs-12">
											<div class="form-group">
												<label>Farbpalette*</label>
												<div class="dropdown">
													<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Farbpalettenwahl
													<span class="caret"></span></button>
													<ul class="dropdown-menu dropdown-menu-center" style="columns: 4; 	-webkit-columns: 4;	-moz-columns: 4;">
													<li style="margin-right: 15px;" ng-repeat="colorPaletteEntry in colorbrewerPalettes">
														<a href="" ng-click="onClickColorBrewerEntry(colorPaletteEntry)">
															<div style="display: inline-block;">
																<svg width="100" height="20">
																	
																		<rect ng-repeat="color in colorPaletteEntry.paletteArrayObject['5']" ng-attr-fill="{{color}}" width="20" height="20" ng-attr-x="{{$index * 20}}"></rect>
																													
																</svg>
															</div>
														</a>
													</li>
													</ul>
												</div>
												<div class="help-block with-errors"></div>
											</div>
										</div>

										<div class="col-md-4 col-sm-6 col-xs-12">
											<div class="form-group">

													<label>derzeit selektiert: </label>
													<div style="display: inline-block;">
														<svg width="100" height="20">
															
																<rect ng-repeat="color in selectedColorBrewerPaletteEntry.paletteArrayObject['5']" ng-attr-fill="{{color}}" width="20" height="20" ng-attr-x="{{$index * 20}}"></rect>
																											
														</svg>
													</div>
											</div> 
										</div>									
									</div>	
									
									<h3 class="fs-subtitle">Sollte der Indikator negative und positive Werte enthalten, so wird in KomMonitor standardm&auml;&szlig; folgende zweifarbige Klassifizierung verwendet</h3>

									<div class="row vertical-align">
										<!-- <div class="col-md-5 col-sm-6 col-xs-12">
											<div class="form-group">
												<label>Anzahl Klassen*</label>
												<select ng-model="numClasses"											
													class="form-control" required>
													<option disabled selected value> -- Anzahl Klassen w&auml;hlen -- </option>
													<option ng-repeat="numClassesEntry in numClassesArray">{{numClassesEntry}}</option>
												</select>
												<div class="help-block with-errors"></div>
											</div>
										</div> -->
										<div class="col-md-4 col-sm-6 col-xs-12">
											<div class="form-group">

												<label>Farbspektrum f&uuml;r negative Werte: </label>
												<div style="display: inline-block;">
													<svg width="100" height="20">
														
															<rect ng-repeat="color in colorbrewerSchemes[colorbreweSchemeName_dynamicDecrease]['5']" ng-attr-fill="{{color}}" width="20" height="20" ng-attr-x="{{$index * 20}}"></rect>
																										
													</svg>
												</div>
										</div> 
										</div>

										<div class="col-md-4 col-sm-6 col-xs-12">
											<div class="form-group">

												<label>Farbspektrum f&uuml;r positive Werte: </label>
												<div style="display: inline-block;">
													<svg width="100" height="20">
														
															<rect ng-repeat="color in colorbrewerSchemes[colorbreweSchemeName_dynamicIncrease]['5']" ng-attr-fill="{{color}}" width="20" height="20" ng-attr-x="{{$index * 20}}"></rect>
																										
													</svg>
												</div>
											</div> 
										</div>									
									</div>	
								
								</div>

								<div ng-show="indicatorType.apiName.includes('DYNAMIC')">									
									<h3 class="fs-subtitle">Da ein dynamischer Indikatorentyp ('{{indicatorType.displayName}}') konfiguriert wurde, ist hier keine Angabe erforderlich. Es wird folgende zweifarbige Standard-Klassifizierung verwendet</h3>

									<div class="row vertical-align">
										<!-- <div class="col-md-5 col-sm-6 col-xs-12">
											<div class="form-group">
												<label>Anzahl Klassen*</label>
												<select ng-model="numClasses"											
													class="form-control" required>
													<option disabled selected value> -- Anzahl Klassen w&auml;hlen -- </option>
													<option ng-repeat="numClassesEntry in numClassesArray">{{numClassesEntry}}</option>
												</select>
												<div class="help-block with-errors"></div>
											</div>
										</div> -->
										<div class="col-md-4 col-sm-6 col-xs-12">
											<div class="form-group">

												<label>Farbspektrum f&uuml;r negative Werte: </label>
												<div style="display: inline-block;">
													<svg width="100" height="20">
														
															<rect ng-repeat="color in colorbrewerSchemes[colorbreweSchemeName_dynamicDecrease]['5']" ng-attr-fill="{{color}}" width="20" height="20" ng-attr-x="{{$index * 20}}"></rect>
																										
													</svg>
												</div>
										</div> 
										</div>

										<div class="col-md-4 col-sm-6 col-xs-12">
											<div class="form-group">

												<label>Farbspektrum f&uuml;r positive Werte: </label>
												<div style="display: inline-block;">
													<svg width="100" height="20">
														
															<rect ng-repeat="color in colorbrewerSchemes[colorbreweSchemeName_dynamicIncrease]['5']" ng-attr-fill="{{color}}" width="20" height="20" ng-attr-x="{{$index * 20}}"></rect>
																										
													</svg>
												</div>
											</div> 
										</div>									
									</div>	
								
								</div>

								<div class="row vertical-align">
									<div class="classificationMethodSelectContainer form-group">
										<label>Klassifizierungsmethode</label>
										<classification-method-select 
											on-method-selected="onClassificationMethodSelected(method)"
											default-method-id="{{classificationMethod}}"
											hidden-method-ids="['manual']">
										</classification-method-select>
									</div>
								</div>
								<div class="row vertical-align">
									<div class="form-group">
										<label>Anzahl Klassen pro Raumeinheit</label>
										<select ng-model="numClassesPerSpatialUnit"
											ng-change="onNumClassesChanged(numClassesPerSpatialUnit)"	
											ng-options="numClassesEntry for numClassesEntry in numClassesArray"								
											class="form-control" required>
											<option disabled selected value> -- Anzahl Klassen w&auml;hlen -- </option>
										</select>
										<div class="help-block with-errors"></div>
										<div class="help-block">
											<p>Für jede Raumeinheit wird die gleiche Anzahl an Klassengrenzen vergeben </p>
										</div>
									</div>
								</div>
								<div class="row vertical-align" ng-if="(numClassesPerSpatialUnit > 0) && classificationMethod == 'regional_default'">
									<uib-tabset active="0">
										<uib-tab 
											index="i" 
											heading="{{spatialUnit.spatialUnitLevel}}"
											class="{{tabClasses[i]}}"
											ng-repeat="(i, spatialUnit) in $ctrl.kommonitorDataExchangeServiceInstance.availableSpatialUnits">
											<div class="just-padding">
												<div class="col-md-6 col-sm-6 col-xs-12">
													<div class="form-group">
														<label>Klassengrenzen für die Ebene {{spatialUnit.spatialUnitLevel}}</label>
														<input
															ng-repeat="(j, b) in spatialUnitClassification[i].breaks track by $index"
															type="number"
															class="form-control"
															ng-blur="onBreaksChanged(i)"
															ng-model="spatialUnitClassification[i].breaks[j]">
													</div>
												</div>
												<div class="col-md-6 col-sm-6 col-xs-12 boxedLegend">
													<p><b>Legende</b></p>
													<div class="row" style="margin-right: 0px;">
														<div class="col-md-3"><b>Symbolik</b></div>
														<div class="col-md-9"><b>Wertebereich</b></div>
													</div>
													<div class="row" 
														style="margin-right: 0px;" 
														ng-repeat="color in selectedColorBrewerPaletteEntry.paletteArrayObject[numClassesPerSpatialUnit.toString()]">
														<div class="col-md-3 "><i style="background:{{color}};"></i> </div>
														<div class="col-md-9 " ng-if="$index == 0" >Niedrigster Wert &dash; &lt; {{spatialUnitClassification[i].breaks[$index] || "[bitte eingeben]"}}</div>
														<div class="col-md-9 " ng-if="$index != 0 && $index != spatialUnitClassification[i].breaks.length" >{{spatialUnitClassification[i].breaks[$index - 1] || "[bitte eingeben]"}} &dash; &lt; {{spatialUnitClassification[i].breaks[$index] || "[bitte eingeben]"}}</div>
														<div class="col-md-9 " ng-if="$index == spatialUnitClassification[i].breaks.length" >{{spatialUnitClassification[i].breaks[$index-1] || "[bitte eingeben]"}} &dash; &lt; Höchster Wert</div>
													</div>
												</div>
											</div>
										</uib-tab>
									</uib-tabset>
								</div>
								<div class="help-block row" ng-if="(numClassesPerSpatialUnit > 0) && classificationMethod == 'regional_default'">
									<p>Vollständig ausgefüllte Tabs werden grün hervorgehoben.</p>
									<p>Fehlerhaft ausgefüllte Tabs werden rot hervorgehoben. Die Klassengrenzen sollten von niedrig nach hoch sortiert sein. </p>
								</div>

								<input type="button" name="previous" class="previous previous_editIndicatorMetadata action-button-previous" value="Voriger Schritt"/>
								<input type="button" name="next" class="next next_editIndicatorMetadata action-button" value="N&auml;chster Schritt" ng-if="$ctrl.kommonitorDataExchangeServiceInstance.enableKeycloakSecurity"/>

							</fieldset>

								<fieldset ng-if="$ctrl.kommonitorDataExchangeServiceInstance.enableKeycloakSecurity">

									<h2 class="fs-title">Rollenbasierter Zugriffsschutz</h2>
									<h3 class="fs-subtitle">Vergabe der Zugriffsrechte auf Indikatoren-Metadaten pro Organisationseinheit</h3>
		
									<p>Zugriffsrechte (lesen, editieren, l&ouml;schen) m&uuml;ssen explizit vergeben werden. Administratoren (Rolle <i>kommonitor-creator</i>) haben immer vollen Zugriff.</p>
	
									<p><strong>Bei Indikatoren muss zus&auml;tzlich zu den Metadaten f&uuml;r jede verkn&uuml;pfte Raumebene der Zugriff auf die Zeitreihen-Daten freigegeben werden. Dazu nutzen Sie bitte das Feature-Fortf&uuml;hren-Men&uuml;.</strong></p>
		
									<div class="row">
										<div class="col-md-3"></div>
										<div class="col-md-6 col-sm-6 col-xs-12">
												<div id="indicatorEditRoleManagementTable" style="height: 45vh" class="ag-theme-alpine"></div>  
											
										</div>
										<div class="col-md-3"></div>
									</div>	
									
									<input type="button" name="previous" class="previous previous_editIndicatorMetadata action-button-previous" value="Voriger Schritt"/>								
								</fieldset>						

						</form>
					</div>
				</div>

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default pull-left" data-dismiss="modal">Schlie&szlig;en</button>
				<button type="button" class="btn btn-info pull-left" ng-click="onImportIndicatorEditMetadata()"
					title="Importieren der Metadaten aus einer Datei"><i
						class="fas fa-file-import"></i>&nbsp;&nbsp;Metadaten-Import</button>
				<input style="display:none;" class="pull-left" type="file" class="form-control"
					id="indicatorEditMetadataImportFile" accept=".json,"></input>
				<button type="button" style="margin-left: 6px;" class="btn btn-info pull-left" ng-disabled=""
					ng-click="onExportIndicatorEditMetadata()" title="Exportieren der Metadaten in eine Datei"><i
						class="fas fa-file-export"></i>&nbsp;&nbsp;Metadaten-Export</button>
				<button type="button" style="margin-left: 6px;" class="btn btn-info pull-left" ng-disabled="" ng-click="onExportIndicatorEditMetadataTemplate()" title="Exportieren einer Metadaten-Vorlage in eine Datei"><i class="fas fa-file-export"></i>&nbsp;&nbsp;Metadaten-Export Vorlage</button>
						

				<button type="button" class="btn btn-success"
					ng-disabled="!datasetName || !metadata.description || !metadata.datasource || !metadata.contact || !metadata.updateInterval || !metadata.lastUpdate || !indicatorType|| !indicatorCreationType || !indicatorInterpretation || !indicatorTopic_mainTopic || datasetNameInvalid || !indicatorUnit || classBreaksInvalid"
					ng-click="editIndicatorMetadata()">Metadaten aktualisieren</button>
				<button type="button" class="btn btn-danger"
					ng-click="resetIndicatorEditMetadataForm()">Zur&uuml;cksetzen</button>
			</div>

			<div id="indicatorEditMetadataSuccessAlert" style="position: absolute; bottom: 0px; width: 100%;" hidden
				class="alert alert-success alert-dismissable">
				<button type="button" class="close" ng-click="hideSuccessAlert()" aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-check"></i>Indikator aktualisiert</h4>
				Die Metadaten des Indikators mit Namen {{successMessagePart}} wurden in KomMonitor aktualisiert und in
				die &Uuml;bersichtstabelle eingetragen.
			</div>

			<div id="indicatorEditMetadataErrorAlert" style="position: absolute; bottom: 0px; width: 100%;" hidden
				class="alert alert-danger alert-dismissable">
				<button type="button" class="close" ng-click="hideErrorAlert()" aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-ban"></i>Aktualisierung gescheitert</h4>
				Bei der Aktualisierung der Metadaten des Indikators ist ein Fehler aufgetreten. Fehlermeldung:
				<br />
				<pre style="overflow:auto; max-height:500px;" ng-bind-html="errorMessagePart"></pre>
			</div>

			<div id="indicatorEditMetadataImportErrorAlert" style="position: absolute; bottom: 0px; width: 100%;"
				hidden class="alert alert-danger alert-dismissable">
				<button type="button" class="close" ng-click="hideMetadataErrorAlert()"
					aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-ban"></i>Metadata Import gescheitert</h4>
				Beim Import der Metadaten aus einer Datei ist ein Fehler aufgetreten. Fehlermeldung:
				<br />
				<pre>{{indicatorEditMetadataImportError}}</pre>
				<br />
				<br />
				<p>Bitte stellen Sie sicher, dass folgendes JSON-Format eingehalten wird:</p>
				<pre id="indicatorsEditMetadataPre" style="overflow:auto; max-height:500px;"></pre>
			</div>

		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->