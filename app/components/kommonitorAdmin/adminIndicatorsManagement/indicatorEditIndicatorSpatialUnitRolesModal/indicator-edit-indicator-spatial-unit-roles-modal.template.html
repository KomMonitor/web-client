<div class="modal fade" id="modal-edit-indicator-spatial-unit-roles" role="dialog">
	<div class="modal-dialog modal-xl">
		<div class="modal-content">

			<div align="center">
				<div class="loading-overlay-admin-panel ng-hide" ng-show="loadingData">
					<span class="glyphicon glyphicon-refresh icon-spin"></span>
				</div>
			</div>


			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">Zugriffsschutz und Eigent&uuml;merschaft für Indikator
					<i><b>{{currentIndicatorDataset.indicatorName}}</b></i> und dessen verkn&uuml;pfte Raumebenen editieren</h4>
			</div>
			<div class="modal-body">
				
				
				<!-- MultiStep Form -->
				<div class="row">
					<div class="col-md-12">
						<form class="multiStepForm form-group" id="indicatorEditIndicatorSpatialUnitRolesForm" role="form"
							data-toggle="validator" data-disable="true" style="margin-bottom: 0px;">
							<!-- progressbar -->
							<div>
								<ul id="progressbar">
									<li style="width: 33.33%" class="active">Zugriffsschutz Indikator-Metadaten</li>
									<li style="width: 33.33%">Zugriffsschutz Indikator-Zeitreihe pro Raumeinheit</li>
									<li style="width: 33.33%">Eigent&uuml;merschaft</li>
								</ul>
							</div>
							<!-- fieldsets -->

							<fieldset>
								<h2 class="fs-title">Zugriffsschutz Indikator-Metadaten</h2>
								<h3 class="fs-subtitle">Vergabe der Zugriffsrechte auf Indikator-Metadaten pro Organisationseinheit. Hiermit legen Sie fest, 
									welche Organisationseinheiten den Indikator lesen und/oder editieren d&uuml;rfen</h3>
	
								<p>Zugriffsrechte (lesen, editieren) m&uuml;ssen explizit vergeben werden</p>
	
								<div class="row">
                  <div class="col-md-12 col-sm-12 col-xs-12" ng-show="permissions.length!=0">
                    <div class="form-group vertical-align">
                        <label class="margin-right">Zeige nur zugewiesene Rechte</label>
                        <label class="switch">
                            <input type="checkbox" value="activeRolesOnly" ng-model="activeRolesOnly" ng-change="onActiveRolesOnlyChange()" ng-disabled="permissions.length==0">
                            <span class="switchslider round"></span>
                        </label>
                    </div>
                  </div>
									<div class="col-md-3">
										<label>&Ouml;ffentliche Lesefreigabe*</label>
												<label class="switch">
													<input type="checkbox" ng-model="currentIndicatorDataset.isPublic">
													<span class="switchslider round"></span>
												</label>
												<div class="help-block">
													<p>
														&Ouml;ffentlich freigegebene Datens&auml;tze k&ouml;nnen ohne Login abgerufen werden.
													</p>
												</div>
									</div>
									<div class="col-md-6 col-sm-6 col-xs-12">
											<!-- <div id="georesourceAddRoleManagementTable" style="height: 40vh; overflow-y: auto;" class="ag-theme-alpine"></div>     -->
											<div id="indicatorEditRoleManagementTable" style="height: 45vh" class="ag-theme-alpine"></div>  
										
									</div>
									<div class="col-md-3">
										<div class="alert alert-info">
											Als Eigent&uuml;mer-Organisation des Datensatzes k&ouml;nnen Sie Lese- und Editier-Rechte an die eigene und weitere Organisationseinheiten vergeben. 
										</div>
									</div>
								</div>	
								
								
								<input type="button" name="next" class="next next_editIndicatorRoles action-button" value="N&auml;chster Schritt"/>							
							</fieldset>	
	
							<fieldset>
								<h2 class="fs-title">Zeitreihen-Zugriffsschutz f&uuml;r verknüpfte Raumebenen</h2>
								<h3 class="fs-subtitle">Vergabe der Zugriffsrechte auf die Indikator-Zeitreihen der einzelnen Raumebenen. Zus&uuml;tzlich zu den Metadaten
									muss der Zugriff auf die Zeitreihe einer verkn&uuml;pften Raumeinheit explizit f&uuml;r authorisierte Organisationseinheiten freigegeben werden.</h3>
		
								
								
								<div class="row">
                  <div class="col-md-12 col-sm-12 col-xs-12" ng-show="targetApplicableSpatialUnit.permissions.length!=0">
                    <div class="form-group vertical-align">
                        <label class="margin-right">Zeige nur zugewiesene Rechte</label>
                        <label class="switch">
                            <input type="checkbox" value="activeConnectedRolesOnly" ng-model="activeConnectedRolesOnly" ng-change="onActiveConnectedRolesOnlyChange()" ng-disabled="targetApplicableSpatialUnit.permissions.length==0">
                            <span class="switchslider round"></span>
                        </label>
                    </div>
                  </div>
                </div>
                <div class="row vertical-align">
									<div class="col-md-3 col-sm-6 col-xs-12">
											<label>Ziel-Raumebene*</label>
											
											<select ng-model="targetApplicableSpatialUnit" ng-options="spatialUnit as spatialUnit.spatialUnitName for spatialUnit in currentIndicatorDataset.applicableSpatialUnits"
                        class="form-control" ng-change="onChangeSelectedSpatialUnit(targetApplicableSpatialUnit)" required>
                        <option disabled selected value> -- Ziel-Raumebene w&auml;hlen -- </option>
                      </select>
                      <br>
                      <label>&Ouml;ffentliche Lesefreigabe*</label>
                      <label class="switch">
                        <input type="checkbox" ng-model="targetApplicableSpatialUnit.isPublic">
                        <span class="switchslider round"></span>
                      </label>
                      <div class="help-block">
                        <p>
                          &Ouml;ffentlich freigegebene Datens&auml;tze k&ouml;nnen ohne Login abgerufen werden.
                        </p>
                      </div>
                      <div class="form-group">
												<div class="help-block with-errors"></div>
	
										</div>
									</div>

								<!-- <div class="row">
									<div class="col-md-3"></div>
									<div class="col-md-6 col-sm-6 col-xs-12">
											 
										
									</div>
									<div class="col-md-3"></div>
								</div>	 -->

									<div class="col-md-9 col-sm-6 col-xs-12">
										
										<div id="indicatorEditIndicatorSpatialUnitsRoleManagementTable" style="height: 45vh" class="ag-theme-alpine"></div> 
									</div>

								</div>

								<input type="button" name="next" class="next next_editIndicatorRoles action-button" value="N&auml;chster Schritt"/>	

								<input type="button" name="previous"
									class="previous previous_editIndicatorRoles action-button-previous"
									value="Voriger Schritt" />											
							</fieldset>

							<fieldset>
								<h2 class="fs-title">Eigentümerschaft eines Datensatzes</h2>
									<h3 class="fs-subtitle">&Uuml;betragen der Eigentümerschaft von Datens&auml;tzen mit allen dazugeh&ouml;rigen Rechten</h3>
									<div class="alert alert-danger">
										Bitte beachten Sie, dass Sie beim &Uuml;bertragen einer Eigentümerschaft einer Resource unter Umst&auml;nden jegliche Rechte eben dieser verlieren.<br>Die Rechte werden unwiderruflich und sofort an den neuen Eigent&uuml;mer &uuml;bertragen.
									</div>
									<div class="row">
										<div class="col-md-3"></div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<label for="targetUserRoleSelect"><b>Eigent&uuml;merschaft &uuml;bertragen an</b></label>
											<div class="input-group">
												<span class="input-group-addon"><i class="fas fa-filter"></i></span>
												<input type="text" class="form-control input-sm" placeholder="Stichwortfilter" ng-model="ownerOrgFilter" ng-model-options="{debounce: 500, blur: 0}">
											</div>
											<select ng-if="$ctrl.kommonitorDataExchangeServiceInstance.checkAdminPermission()" id="targetUserRoleSelect" ng-model="ownerOrganization" class="form-control" ng-change="onChangeOwner(ownerOrganization)" required>
												<option selected value><b>Eigent&uuml;merschaft nicht &uuml;bertragen</b></option>
												<option ng-repeat="org in $ctrl.kommonitorDataExchangeServiceInstance.accessControl | filter:ownerOrgFilter" value="{{org.organizationalUnitId}}">{{org.name}}</option>
											</select>
											<select ng-if="!$ctrl.kommonitorDataExchangeServiceInstance.checkAdminPermission()" id="targetUserRoleSelect" ng-model="ownerOrganization" class="form-control" ng-change="onChangeOwner(ownerOrganization)" required>
												<option selected value><b>Eigent&uuml;merschaft nicht &uuml;bertragen</b></option>
												<option ng-repeat="org in resourcesCreatorRights | filter:ownerOrgFilter" value="{{org.organizationalUnitId}}">{{org.name}}</option>
											</select>
										</div>
										<div class="col-md-3">
											<label>aktuelle Eigent&uuml;mer-Organisationseinheit</label>
											<p>{{$ctrl.kommonitorDataExchangeServiceInstance.getAccessControlById(currentIndicatorDataset.ownerId).name}}</p>
											<div class="help-block" style="color: red" ng-if="ownerOrganization != currentIndicatorDataset.ownerId">
												<p>
													ACHTUNG: Sie sind dabei, die Eigent&uuml;merschaft an diesem Datensatz zu &auml;ndern.
												</p>
											</div>
										</div>
									</div>

									<input type="button" name="previous"
									class="previous previous_editIndicatorRoles action-button-previous"
									value="Voriger Schritt" />
							</fieldset>

						</form>
					</div>
				</div>

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default pull-left" data-dismiss="modal">Schlie&szlig;en</button>

				<button type="button" class="btn btn-success"
					ng-click="editIndicatorSpatialUnitRoles()">Aktualisieren</button>
				<button type="button" class="btn btn-danger"
					ng-click="resetIndicatorEditIndicatorSpatialUnitRolesForm()">Zur&uuml;cksetzen</button>
			</div>

			<div id="indicatorEditIndicatorSpatialUnitRolesSuccessAlert" style="position: absolute; bottom: 0px; width: 100%;" hidden
				class="alert alert-success alert-dismissable">
				<button type="button" class="close" ng-click="hideSuccessAlert()" aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-check"></i>Zugriffsschutz und Eigent&uuml;merschaft aktualisiert</h4>
				Erfolgreiche Aktualisierung des Zugriffsschutzes und der Eigent&uuml;merschaft f&uuml;r Indikator '{{currentIndicatorDataset.indicatorName}}'.
				<br>
				sowie
				<br>
				Erfolgreiche Aktualisierung des Zugriffsschutzes f&uuml;r verknüpfte Raumebene '{{targetApplicableSpatialUnit.spatialUnitName}}'
			</div>

			<div id="indicatorEditIndicatorSpatialUnitRolesErrorAlert" style="position: absolute; bottom: 0px; width: 100%;" hidden
				class="alert alert-danger alert-dismissable">
				<button type="button" class="close" ng-click="hideErrorAlert()" aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-ban"></i>Aktualisierung gescheitert</h4>
				Bei der Aktualisierung des Zugriffsschutzes und der Eigent&uuml;merschaft ist ein Fehler aufgetreten. Fehlermeldung:
				<br />
				<pre style="overflow:auto; max-height:500px;" ng-bind-html="errorMessagePart"></pre>
			</div>

		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->