<!-- <div class="container-fluid"> -->

	<header id="header" class="main-header">

		<div  style="position:absolute; left:40%;  padding-top: 4px;">

			<h4 ng-bind-html="::$ctrl.kommonitorDataExchangeServiceInstance.appTitle"></h4>
		</div>

		<div style="padding-left: 10px; padding-top: 4px;">

			 <a target="_blank" rel="noopener noreferrer" href="http://kommonitor.de"><img style="float: left; width: 35px; height: 35px; margin-right: 0.5%;" src="logos/KM_Logo1.svg"></img></a>
			 <div ng-if="$ctrl.kommonitorDataExchangeServiceInstance.customLogoURL && $ctrl.kommonitorDataExchangeServiceInstance.customLogoWidth">
				<a target="_blank" rel="noopener noreferrer" href="{{$ctrl.kommonitorDataExchangeServiceInstance.customLogo_onClickURL}}">
					<img src="{{$ctrl.kommonitorDataExchangeServiceInstance.customLogoURL}}" style="float: left; width: {{$ctrl.kommonitorDataExchangeServiceInstance.customLogoWidth}}; height: 35px; margin-right: 0.5%;"></img>
				</a>
				
			 </div> 			  

			<a id="userLogin" ng-mouseover="showUserLogin = true" ng-init="showUserLogin = false" title="Useristration" style="font-size:1.2em; float: right; margin-right: 2%; margin-left: 2%; margin-top: 0.5%;"><i class="fas fa-user-cog"></i></a>
			<div id="userLoginForm" ng-show="showUserLogin && $ctrl.kommonitorDataExchangeServiceInstance.enableKeycloakSecurity" ng-mouseleave="showUserLogin = false" class="userFormWrapper">
				<div id="userForm">
					<h4>User Login</h4>
					<div ng-if="authenticated" style="margin-bottom: 10px;">
						<span><b>Nutzername:</b></span> <i>{{$ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.username}}</i>
						<div ng-if="$ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.firstName && $ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.lastName">
							<span style="word-break: break-all;"><b>Vor- und Nachname:</b><i> {{$ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.firstName}} {{$ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.lastName}}</i></span>
						</div>
						<div ng-if="! $ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.firstName && $ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.lastName">
							<span style="word-break: break-all;"><b>Nachname:</b><i>({{$ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.lastName}}</i></span>
						</div>
						<div ng-if="$ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.email">
							<span style="word-break: break-all;"><b>E-Mail:</b><i>{{$ctrl.kommonitorDataExchangeServiceInstance.currentKeycloakUser.email}}</i></span>
						</div>
						<br/>
						<div class="box box-simplified collapsed-box">
							<div class="box-header with-border">
							  <h3 class="box-title">Rollen</h3>
					  
							  <div class="box-tools pull-right">
								<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
								</button>
							  </div>
							</div>
							<!-- /.box-header -->
							<div class="box-body">
							  <table>
								<tr ng-repeat="(key, value) in userRoleInformation">
								  <td>
									<table>
									  <tr>
										<th>{{key}}</th>
									  </tr>
									  </tr>
										<td style="padding-left: 1em;"><p ng-repeat="role in value">{{role}}</p></td>
									  </tr>
									</table>
								  </td>
								</tr>
							  </table>
							</div>
							<!-- /.box-body -->
						  </div>
						  <!-- /.box -->
			
						  <div class="box box-simplified collapsed-box">
							<div class="box-header with-border">
							  <h3 class="box-title">Gruppen (Hierarchie)</h3>
					  
							  <div class="box-tools pull-right">
								<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
								</button>
							  </div>
							</div>
							<!-- /.box-header -->
							<div class="box-body">
							  <table>
								<tr ng-repeat="entry in userGroupInformation">
								  <td>
									<p ng-style="{margin: 0,'padding-left': '{{$index + 'em'}}'}" ng-repeat="group in entry track by $index">{{group}}</p>
								  </td>
								</tr>
							  </table>
							</div>
							<!-- /.box-body -->
						  </div>
						  <!-- /.box --> 
						<span><b>Session G&uuml;ltigkeit:</b> {{$ctrl.kommonitorDataExchangeServiceInstance.keycloakTokenExpirationInfo}} Minuten</span>
					</div>
					<input type="submit" ng-if="!authenticated" value="Login" id='input_submit' ng-click="tryLoginUser()" class='input_field' >
					<input type="submit" ng-if="authenticated" value="Logout" id='input_submit' ng-click="$ctrl.kommonitorDataExchangeServiceInstance.tryLogoutUser()" class='input_field input_authenticated' >
					<input type="submit" ng-if="authenticated" value="Relogin" ng-click="$ctrl.kommonitorDataExchangeServiceInstance.extendKeycloakSession()" class='input_field input_extend_session' >
				</div>
			</div>
			<a ng-if="showAdminLogin" ng-click="openAdminUI()" style="font-size:1.2em; float: right; margin-right: 1%; margin-top: 0.5%; cursor:pointer;" title="Admin UI&nbsp;&nbsp;"><span class="fas fa-cogs"></span></a>
			<a ng-click="openInfoModal()" href="#infoModal" style="font-size:1.2em; float: right; margin-right: 1%; margin-top: 0.5%; cursor:pointer;" title="Information&nbsp;&nbsp;"><span class="glyphicon glyphicon-info-sign"></span></a>
			<!-- <a data-toggle="modal" data-target="#feedbackModal" style="font-size:1.2em; float: right; margin-right: 1%; margin-top: 0.5%;  cursor:pointer;" title="Feedback&nbsp;&nbsp;"><span class="glyphicon glyphicon-envelope"></span></a> -->
			<a ng-click="startGuidedTour()" style="font-size:1.2em; float: right; margin-right: 1%; margin-top: 0.5%;  cursor:pointer;" title="Guided Tour&nbsp;&nbsp;"><span class="glyphicon glyphicon-play"></span></a>
			
			<div id="reportingButton" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.reportingButton">
				<a data-toggle="modal" data-target="#reporting-modal" style="font-size:1.2em; float: right; margin-right: 1%; margin-top: 0.5%; cursor:pointer;" title="Report erstellen&nbsp;&nbsp;">
					<i class="fas fa-file-alt"></i>
				</a>
			</div>			
			<div id="switchAdvancedMode" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.showAdvancedModeSwitch" 
			style="float: right; margin-right: 1%; margin-top: 0.5%; cursor: pointer">
				<strong>Erweiterte Ansicht</strong> &nbsp;
				<label class="switch" title="Ein- / Ausblenden von UI Elementen"><input type="checkbox" ng-model="$ctrl.kommonitorElementVisibilityHelperServiceInstance.isAdvancedMode" 
					ng-checked="$ctrl.kommonitorElementVisibilityHelperServiceInstance.isAdvancedMode"
					ng-change="$ctrl.kommonitorElementVisibilityHelperServiceInstance.onChangeIsAdvancedMode()" ><span class="switchslider round"></span></label>
			</div>
			<p style="clear: both;"></p>

			

		</div>

	</header>

	<!-- new NG Components -->
  <!-- !!!!IMPORTANT: NO ThisIsMyVar as @Input var name, make it all lower case, "thisismyvar"..  -->
	<info-modal [open]="infoModalTrigger"></info-modal>
  <kommonitor-legend-new [onupdatelegenddisplaydata]="onUpdateLegendDisplayEmitterData"></kommonitor-legend-new>

	<!-- Modal -->
	<feedback-modal></feedback-modal>

	<!-- Modal -->
	<spatial-unit-notification-modal></spatial-unit-notification-modal>

	<!-- Modal -->
	<reporting-modal></reporting-modal>

	<!-- Modal -->
	<div id="reachabilityScenarioModalContainer">
		<reachability-scenario-modal></reachability-scenario-modal>
	</div>

	<!-- Modal -->
	<wms-modal></wms-modal>

	<!-- Modal -->
	<wfs-modal></wfs-modal>

	<div class="kmWrapper">

    <!-- Sidebar -->
    <aside id="sidebarIndicatorConfig" ng-class="sidebarIndicatorConfigClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.indicatorConfig">
        <kommonitor-data-setup></kommonitor-data-setup>
    </aside>

	 <aside id="sidebarNotifier" ng-class="sidebarNotifierClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.notifier">
        <app-gsoc-demo></app-gsoc-demo>
    </aside>

		<aside id="sidebarPoi" ng-class="sidebarPoiClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.poi">
        <poi></poi>
    </aside>

		<aside id="sidebarDataImport" ng-class="sidebarDataImportClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.dataImport">
        <kommonitor-data-import></kommonitor-data-import>
    </aside>

		<aside id="sidebarFilter" ng-class="sidebarFilterClass" ng-show="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.filter">
        <kommonitor-filter></kommonitor-filter>
    </aside>

		<aside id="sidebarMeasureOfValueClassification" ng-class="sidebarMeasureOfValueClassificationClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.measureOfValueClassification">
        <measure-of-value-classification></measure-of-value-classification>
    </aside>

		<aside id="sidebarBalance" ng-class="sidebarBalanceClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.balance">
        <kommonitor-balance></kommonitor-balance>
    </aside>

		<aside id="sidebarDiagrams" ng-class="sidebarDiagramsClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.diagrams">
        <kommonitor-diagrams></kommonitor-diagrams>
    </aside>

		<aside id="sidebarRadarDiagram" ng-class="sidebarRadarDiagramClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.radarDiagram">
        <indicator-radar></indicator-radar>
    </aside>

		<aside id="sidebarRegressionDiagram" ng-class="sidebarRegressionDiagramClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.regressionDiagram">
        <regression-diagram></regression-diagram>
    </aside>

		<aside id="sidebarReachability" ng-class="sidebarReachabilityClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.reachability">
        <kommonitor-reachability></kommonitor-reachability>
    </aside>

		<!-- hide processing button and menu, as it must be greatly improved -->
		<!-- <aside id="sidebarProcessing" ng-class="sidebarProcessingClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.processing">
        <kommonitor-individual-indicator-computation></kommonitor-individual-indicator-computation>
    </aside> -->

	<!-- right side legend menu -->
	<aside id="sidebarLegend" ng-class="sidebarLegendClass" >
        <kommonitor-legend></kommonitor-legend>
    </aside>

    <!-- Page Content -->
    <div id="content" style="height: 100%; width: 100%; position: relative;">

        <kommonitor-map style="height: 100%; width: 100%; position: absolute;"></kommonitor-map>
		
		<button type="button" id="sidebarLegendCollapse"
		ng-click="onSidebarLegendButtonClick()" ng-class="buttonLegendClass" data-toggle="tooltip" title="Legenden- und Informationsfenster">
		<i style="font-size:2.5vh;" class="fas fa-info"></i>
	</button>

				<!-- LEFT-HANDED SIDEBAR BUTTONS -->

				<div id="sideBarButtons">
					<button type="button" style="display: block; position: relative; margin-top: 5px;" id="toggleGsocDemoButton"
				ng-class="buttonNotifierClass" ng-click="onSidebarNotifierButtonClick()" data-toggle="tooltip" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.notifier" title="Toast Notifier Demo">
					<i style="font-size:2.5vh;" class="fas fa-bell"></i>
					</button>
						<button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarIndicatorConfigCollapse"
							ng-click="onSidebarIndicatorButtonClick()" ng-class="buttonIndicatorConfigClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.indicatorConfig" data-toggle="tooltip" title="Indikatorenauswahl">
								<!-- <span style="font-size:2.5vh;" class="glyphicon glyphicon-th" aria-hidden="true"></span> -->
								<i style="font-size:2.5vh;" class="fas fa-sitemap"></i>
						</button>

						<button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarPoiCollapse"
							ng-click="onSidebarPoiButtonClick()" ng-class="buttonPoiClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.poi" data-toggle="tooltip" title="Infrastrukturdaten">
								<!-- <span style="font-size:2.5vh;" class="glyphicon glyphicon-th" aria-hidden="true"></span> -->
								<i style="font-size:2.5vh;" class="fas fa-map-marker-alt"></i>
						</button>

						 <button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarDataImportCollapse"
							ng-click="onSidebarDataImportButtonClick()" ng-class="buttonDataImportClass"  ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.dataImport" data-toggle="tooltip" title="Datenimport">
								<i style="font-size:2.5vh;" class="fas fa-file-import"></i>
						</button> 

						<button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarFilterCollapse"
							ng-click="onSidebarFilterButtonClick()" ng-class="buttonFilterClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.filter" data-toggle="tooltip" title="Darstellungsfilter">
								<!-- <span style="font-size:2.5vh;" class="glyphicon glyphicon-th" aria-hidden="true"></span> -->
								<i style="font-size:2.5vh;" class="fas fa-filter"></i>
						</button>

						<button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarBalanceCollapse"
							ng-click="onSidebarBalanceButtonClick()" ng-class="buttonBalanceClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.balance" data-toggle="tooltip" title="zeitliche Bilanzierung">
								<!-- <span style="font-size:2.5vh;" class="glyphicon glyphicon-sort" aria-hidden="true"></span> -->
								<i style="font-size:2.5vh;" class="fas fa-chart-line"></i>
						</button>

						<button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarDiagramsCollapse" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.diagrams"
							ng-click="onSidebarDiagramsClick()" ng-class="buttonDiagramsClass" data-toggle="tooltip" title="statistische Diagramme">
								<!-- <span style="font-size:2.5vh;" class="glyphicon glyphicon-stats" aria-hidden="true"></span> -->
								<i style="font-size:2.5vh;" class="fas fa-chart-bar"></i>
						</button>

						<button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarRadarDiagramCollapse"
							ng-click="onSidebarRadarDiagramClick()" ng-class="buttonRadarDiagramClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.radarDiagram" data-toggle="tooltip" title="Indikatorenradar">
								<!-- <span style="font-size:2.5vh;" class="glyphicon glyphicon-star-empty" aria-hidden="true"></span> -->
								<img src="icons/radarMap.svg"></img>
						</button>

						<button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarRegressionDiagramCollapse"
							ng-click="onSidebarRegressionDiagramClick()" ng-class="buttonRegressionDiagramClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.regressionDiagram" data-toggle="tooltip" title="Regressionsdiagramm">
								<!-- <span style="font-size:2.5vh;" class="glyphicon glyphicon-star-empty" aria-hidden="true"></span> -->
								<img src="icons/scatterPlot.svg"></img>
						</button>

						<button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarReachabilityCollapse"
							ng-click="onSidebarReachabilityButtonClick()" ng-class="buttonReachabilityClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.reachability" data-toggle="tooltip" title="Erreichbarkeitsanalyse">
							<i style="font-size:2.5vh;" class="fas fa-route"></i>
								<!-- <span style="font-size:2.5vh;" class="glyphicon glyphicon-wrench" aria-hidden="true"></span> -->
						</button>

						<!-- hide processing button and menu, as it must be greatly improved -->
						<!-- <button type="button" style="display: block; position: relative; margin-top: 5px;" " id="sidebarProcessingCollapse"
							ng-click="onSidebarProcessingClick()" ng-class="buttonProcessingClass" ng-if="$ctrl.kommonitorElementVisibilityHelperServiceInstance.elementVisibility.processing" data-toggle="tooltip" title="Individuelle Indikatorenberechnung">
							<i style="font-size:2.5vh;" class="fas fa-sliders-h"></i>
						</button> -->

				</div>

				<!-- MAP UTIL BUTTONS -->

				<div id="mapUtilButtons">
					<button type="button" id="recenterMapButton"
						ng-click="onRecenterMapButtonClick()" class="btn btn-leaflet-custom" data-toggle="tooltip" title="Karte zentrieren">
							<span style="font-size:1.5em;left:-5px;" class="glyphicon glyphicon-globe" aria-hidden="true"></span>
					</button>

					<button type="button" id="unselectFeaturesButton"
						ng-click="onUnselectFeaturesButtonClick()" class="btn btn-leaflet-custom" data-toggle="tooltip" title="Feature-Selektion aufheben">
							<span style="font-size:1.5em;left:-5px;" class="glyphicon glyphicon-ban-circle" aria-hidden="true"></span>
					</button>

					<button type="button" id="exportMapButton"
						ng-click="onExportMapButtonClick()" class="btn btn-leaflet-custom" data-toggle="tooltip" title="aktuellen Kartenausschnitt exportieren">
							<i style="font-size:1.5em;margin-left:-5px;" class="fas fa-download"></i>
					</button>

					<button type="button" id="openLayerControlButton" data-toggle="button"
						ng-click="onOpenLayerControlButtonClick()" class="btn btn-leaflet-custom" data-toggle="tooltip" title="Layer Control anzeigen">
							<i style="font-size:1.5em;margin-left:-5px;" class="fas fa-layer-group"></i>
					</button>
				</div>

				<!-- Info and legend Control buttons -->				

				<button type="button" style="top: 120px; right:10px; display:none;" id="toggleLegendControlButton"
					ng-click="onToggleLegendControlButtonClick()" class="btn btn-leaflet-custom" data-toggle="tooltip" title="Legende einblenden">
						<span style="font-size:1.3em;" class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
				</button>

	</div>
	
	<div style="position: absolute; left: 12%; top: 200px; width: 75%;" hidden
				class="alert alert-danger alert-dismissable mapApplicationErrorAlert">
				<button type="button" class="close" ng-click="$ctrl.kommonitorDataExchangeServiceInstance.hideErrorAlert()"
					aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-ban"></i>Achtung</h4>
				Es ist ein Fehler bei der Datenverarbeitung aufgetreten. Die Fehlermeldung lautet:
				<br />
				<pre ng-bind-html="$ctrl.kommonitorDataExchangeServiceInstance.errorMessage"></pre>
	</div>

	</div>
