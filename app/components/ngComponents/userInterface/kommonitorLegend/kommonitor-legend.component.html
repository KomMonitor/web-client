<button type="button" id="sidebarLegendCollapse" (click)="legendVisible = !legendVisible" class="buttonLegendClass" title="Legenden- und Informationsfenster">
		<i style="font-size:2.5vh;" class="fas fa-info"></i>
</button>
<div id="legendWrapper" *ngIf="exchangeData.selectedIndicator" [hidden]="!legendVisible">

    <p></p>
  
    <!-- Indicator information  -->
      <div id="kommonitorIndicatorExportAndSpatialUnitSwitch" class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">Raumebene und Export</h3>
  
          <div class="box-tools pull-right">
            <button (click)="exportCollapse.toggle()" id="kommonitorIndicatorExportAndSpatialUnitSwitchCollapse" type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa" [ngClass]="{'fa-plus':isExportCollapsed, 'fa-minus':!isExportCollapsed}"></i>
            </button>
          </div>
        </div>
        <div class="box-body boxedLegend" #exportCollapse="ngbCollapse" [(ngbCollapse)]="isExportCollapsed">

          <div >
            <div>						
              <div class="row" style="margin-right: 0px;">
                <div class="col-sm-7"> <!-- *ngIf="env.enableSpatialUnitNotificationButton" -->
                  <div class="text-left"><label>Raumebene</label><a  data-toggle="modal" (click)="showSpatialUnitNotificationModalIfEnabled()" style="font-size:1.2em; float: right; margin-right: 1%; margin-top: 0.5%; cursor:pointer;" title="Information zu Raumebenen&nbsp;&nbsp;"><span class="glyphicon glyphicon-info-sign"></span></a></div>
                  <!-- <select id="spatialUnitSelectionInput" style="font-size: 12px;" ng-model="exchangeData.selectedSpatialUnit"
                    ng-options="spatialUnit as spatialUnit.spatialUnitLevel for spatialUnit in exchangeData.availableSpatialUnits | filter:filterSpatialUnits()"
                    class="form-control" ng-change="onChangeSelectedSpatialUnit()" required> -->
                    <select (change)="onChangeSelectedSpatialUnit()" [ngModel]="exchangeData.selectedSpatialUnit">
                      <option disabled selected value> -- Raumebene w&auml;hlen --</option>
                      <option *ngFor="let item of filteredSpatialUnits()" [value]="item">{{item.spatialUnitLevel }}</option>
                    </select>
                </div>
                <div class="col-sm-4">
                  <div class="text-left"><label>Datum</label></div>
                    <div class="col-12">
                        <input
                          class="form-control"
                          placeholder="yyyy-mm-dd"
                          name="dp"
                          [(ngModel)]="datePickerDate"
                          [markDisabled]="isDisabledDate"
                          ngbDatepicker
                          #d="ngbDatepicker"
                          (click)="d.toggle()"
                          (ngModelChange)="onChangeIndicatorDatepickerDate()"
                          [disabled]="(exchangeData.disableIndicatorDatePicker===true ? true : false)"
                        />
                    </div>
                </div>
              </div><br>
  
        <!--  *ngIf="elementVisibilityService.elementVisibility?.indicatorLegendExportButtons" -->
              <div class="btn-group"  id="indicatorLegendExportButtons">
                <label><i class="fa fa-file-download"></i>&nbsp;&nbsp;&nbsp;Export</label>
                <br />
                <button id="downloadMetadata" (click)="onClickDownloadMetadata()" class="btn btn-default btn-xs">Metadatenblatt</button>
                <button id="downloadGeoJSON" (click)="downloadIndicatorAsGeoJSON()" class="btn btn-primary btn-xs">GeoJSON</button>
                <button id="downloadShape" ng-click="downloadIndicatorAsShape()" class="btn btn-primary btn-xs">ESRI
                  Shape</button>
                <button id="downloadCSV" ng-click="downloadIndicatorAsCSV()" class="btn btn-primary btn-xs">CSV</button>							
               
              </div>
              <br>
              <br>
              <button title="Teilen Sie die aktuelle Indikatorenansicht mittels eines Links" id="shareLinkButton" (click)="onClickShareLinkButton()" class="btn btn-info btn-xs"><i class="fas fa-share-alt"></i>aktuelle Ansicht teilen</button>
              <div id="snackbar">Link zur aktuellen Indikatoren-Ansicht in Zwischenablage kopiert</div>	
            </div>
          </div>
  
  
        </div>
        <!-- /.box-body -->
      </div>
      <!-- /.box -->
  
      <!-- legend(s)  -->
      <div id="kommonitorLegendSymbology" class="box box-primary" *ngIf="exchangeData.selectedIndicator">
        <div class="box-header with-border">
          <h3 class="box-title">Legenden</h3>
  
          <div class="box-tools pull-right">
            <button (click)="legendCollapse.toggle()" id="legendSymbologyCollapse" type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa" [ngClass]="{'fa-plus':isLegendCollapsed, 'fa-minus':!isLegendCollapsed}"></i>
            </button>
          </div>
        </div>
        <div class="box-body boxedLegend" #legendCollapse="ngbCollapse" [(ngbCollapse)]="isLegendCollapsed">
  
          <ul class="nav nav-tabs" id="legendTabs" role="tablist">
            <li class="nav-item active">
              <a class="nav-link active" id="legendTab1" data-toggle="tab" href="#legendTab1Content"
                role="tab" aria-controls="legendTab1Content" aria-selected="true">Indikator</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="legendTab2" data-toggle="tab" href="#legendTab2Content" role="tab"
                aria-controls="legendTab2Content" aria-selected="false">Indikator-Metadaten</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="legendTab3" data-toggle="tab" href="#legendTab3Content" role="tab"
                aria-controls="legendTab3Content" aria-selected="false">WMS-Dienste</a>
            </li>
          </ul>
          <div class="tab-content" id="legendTabContent">
            <div class="tab-pane active" id="legendTab1Content" role="tabpanel"
              aria-labelledby="legendTab1">
                
              <div class="just-padding">
                
                <h4>{{exchangeData.selectedIndicator.indicatorName}}</h4>
                <h5 *ngIf="visualStyleService.isCustomComputation">&nbsp;-&nbsp; <i>individuelles Berechnungsergebnis</i></h5>
                <p [innerHTML]="exchangeData.selectedIndicator.metadata.description"></p>							
                
                <div *ngIf="exchangeData.selectedIndicator.indicatorType.includes('STATUS') && !exchangeData.isMeasureOfValueChecked && !exchangeData.isBalanceChecked">
                  <em>Darstellung der Indikatorenwerte {{dataExchangeService.tsToDate_withOptionalUpdateInterval(dateAsDate, exchangeData.selectedIndicator.metadata.updateInterval)}}</em>
                  <div *ngIf="exchangeData.selectedIndicator.referenceDateNote">
                    <em><b>Hinweis Referenzdatum:</b> {{exchangeData.selectedIndicator.referenceDateNote}}</em>
                  </div>
                </div>
                <div *ngIf="exchangeData.selectedIndicator.indicatorType.includes('DYNAMIC') && ! exchangeData.isMeasureOfValueChecked && !exchangeData.isBalanceChecked">
                  <em>Darstellung der zeitlichen Entwicklung zum gew&auml;hlten Zeitpunkt {{dataExchangeService.tsToDate_withOptionalUpdateInterval(dateAsDate, exchangeData.selectedIndicator.metadata.updateInterval)}}</em>
                </div>
                <div *ngIf="exchangeData.isMeasureOfValueChecked">
                  <em>Schwellwert-Klassifizierung</em>
                  <em>Gew&auml;hlter Zeitpunkt: </em> {{dataExchangeService.tsToDate_withOptionalUpdateInterval(dateAsDate, exchangeData.selectedIndicator.metadata.updateInterval)}}
                  <em>aktueller Schwellwert: </em> {{exchangeData.measureOfValue}}
                </div>
                <div *ngIf="exchangeData.isBalanceChecked">
                  <em>Bilanzierung - {{exchangeData.indicatorAndMetadataAsBalance['fromDate']}} - {{exchangeData.indicatorAndMetadataAsBalance['toDate']}}</em>
                </div>
                
                <br />
        
                <div *ngIf="exchangeData.selectedIndicator.interpretation && exchangeData.selectedIndicator.interpretation != ''">
                  <label>Interpretationshilfe:</label>
                  <p [innerHTML]="exchangeData.selectedIndicator.interpretation"></p>	
                </div>						
                <br />				
                

                <div class="row" style="margin-right: 0px;">
                  <div class="col-md-3"><b>Symbolik</b></div>
                  <div class="col-md-6"><b>Wertebereich</b> [{{exchangeData.selectedIndicator.unit}}]</div>
                  <div class="col-md-3"><b>Anzahl Raumeinheiten</b></div><br>
                </div>
                <div *ngIf="containsNoData">
                  <div class="row" style="margin-right: 0px;">
                    <div class="col-md-3"><i [ngStyle]="{background: env.efaultColorForNoDataValues, border: '2px solid '+env.defaultBorderColorForNoDataValues, opacity: visualStyleService.currentIndicatorOpacity}"></i></div>
                    <div class="col-md-6">Leerwert</div>
                    <div class="col-md-3">{{visualStyleService.featuresPerNoData}}</div><br>
                  </div>				
                </div>
                <div *ngIf="containsOutliers_low && exchangeData.useOutlierDetectionOnIndicator">
                  <div class="row" style="margin-right: 0px;">
                    <div class="col-md-3"><i ng-bind-html="svgString_outlierLow"></i></div>
                    <div class="col-md-6">untere Ausrei&szlig;er {{makeOutliersLowLegendString(outliers_low)}}</div>
                    <div class="col-md-3">{{visualStyleService.featuresPerOutlierLow}}</div><br>
                  </div>				
                </div>
                <div *ngIf="containsOutliers_high && exchangeData.useOutlierDetectionOnIndicator">
                  <div class="row" style="margin-right: 0px;">
                    <div class="col-md-3"><i ng-bind-html="svgString_outlierHigh"></i></div>
                    <div class="col-md-6">obere Ausrei&szlig;er {{makeOutliersHighLegendString(outliers_high)}}</div>
                    <div class="col-md-3">{{visualStyleService.featuresPerOutlierHigh}}</div><br>
                  </div>				
                </div>
                <div *ngIf="(filterHelperService.filteredIndicatorFeatureIds.size > 0) && (!filterHelperService.completelyRemoveFilteredFeaturesFromDisplay)">
                  <div class="row" style="margin-right: 0px;">
                    <div class="col-md-3"><i [ngStyle]="{background: env.defaultColorForFilteredValues, border: '2px solid '+env.defaultBorderColorForFilteredValues, opacity: visualStyleService.currentIndicatorOpacity}"></i></div>
                    <div class="col-md-6">gefilterte Raumeinheiten</div>
                    <div class="col-md-3">{{filterHelperService.filteredIndicatorFeatureIds.size}}</div><br>
                  </div>				
                </div>
                <br/>
                <!-- Measure of Value legend items -->
                <div *ngIf="exchangeData.isMeasureOfValueChecked">
                  <!-- zero -->
                  <div class="row" style="margin-right: 0px;" *ngIf="exchangeData.classifyZeroSeparately && containsZeroValues">
                    <div class="col-md-3"><i [ngStyle]="{background: env.defaultColorForZeroValues, opacity: visualStyleService.currentIndicatorOpacity}"></i></div>
                    <div class="col-md-6">0</div>
                    <div class="col-md-3">{{visualStyleService.featuresPerZero}}</div><br>
                  </div>	

                  <br/>

                  <!-- lesser than values -->
                  <div class="row" style="margin-right: 0px;" *ngFor="let color of visualStyleService.measureOfValueBrew[1].colors; let i = index">
                    <div class="col-md-3 "><i [ngStyle]="{background: color, opacity: visualStyleService.currentIndicatorOpacity}"></i> </div>
                    <div class="col-md-6 " *ngIf="visualStyleService.measureOfValueBrew[1].breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.measureOfValueBrew[1].breaks[i])}} &dash; &lt; {{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.measureOfValueBrew[1].breaks[i + 1])}}</div>
                    <div class="col-md-6 " *ngIf="! visualStyleService.measureOfValueBrew[1].breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.measureOfValueBrew[1].breaks[i])}}</div>
                    <div class="col-md-3 ">{{visualStyleService.featuresPerColorMap.get(color) || 0}}</div>
                  </div>

                  <br/>

                  <!-- higher than values -->
                  <div class="row" style="margin-right: 0px;" *ngFor="let color of visualStyleService.measureOfValueBrew[0].colors; let i = index">
                    <div class="col-md-3 "><i [ngStyle]="{background: color, opacity: visualStyleService.currentIndicatorOpacity}"></i> </div>
                    <div class="col-md-6 " *ngIf="visualStyleService.measureOfValueBrew[0].breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.measureOfValueBrew[0].breaks[i])}} &dash; &lt; {{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.measureOfValueBrew[0].breaks[i + 1])}}</div>
                    <div class="col-md-6 " *ngIf="! visualStyleService.measureOfValueBrew[0].breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.measureOfValueBrew[0].breaks[i])}}</div>
                    <div class="col-md-3 ">{{visualStyleService.featuresPerColorMap.get(color) || 0}}</div>
                  </div>

                </div>
                <!-- Dynamic legend items -->
                <div *ngIf="(exchangeData.isBalanceChecked || exchangeData.selectedIndicator.indicatorType.includes('DYNAMIC') || containsNegativeValues) && ! exchangeData.isMeasureOfValueChecked">					
                  <!-- < 0 values -->
                   <div *ngIf="visualStyleService.dynamicBrew && visualStyleService.dynamicBrew[1]">
                    <div class="row" style="margin-right: 0px;" *ngFor="let color of visualStyleService.dynamicBrew[1].colors; let i = index">
                      <div class="col-md-3 "><i [ngStyle]="{background: color, opacity: visualStyleService.currentIndicatorOpacity}"></i> </div>
                      <div class="col-md-6 " *ngIf="visualStyleService.dynamicBrew[1].breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.dynamicBrew[1].breaks[i])}} &dash; &lt; {{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.dynamicBrew[1].breaks[i + 1])}}</div>
                      <div class="col-md-6 " *ngIf="! visualStyleService.dynamicBrew[1].breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.dynamicBrew[1].breaks[i])}}</div>
                      <div class="col-md-3 ">{{visualStyleService.featuresPerColorMap.get(color) || 0}}</div>
                    </div>
                  </div>

                  <br/>

                  <!-- zero -->
                  <div class="row" style="margin-right: 0px;" *ngIf="exchangeData.classifyZeroSeparately && containsZeroValues">
                    <div class="col-md-3"><i [ngStyle]="{background: env.defaultColorForZeroValues, opacity: visualStyleService.currentIndicatorOpacity}"></i></div>
                    <div class="col-md-6">0</div>
                    <div class="col-md-3">{{visualStyleService.featuresPerZero}}</div><br>
                  </div>	

                  <br />

                  <!-- > 0 values -->
                   <div *ngIf="visualStyleService.dynamicBrew && visualStyleService.dynamicBrew[0]">
                    <div class="row" style="margin-right: 0px;" *ngFor="let color of visualStyleService.dynamicBrew[0].colors; let i = index">
                      <div class="col-md-3 "><i [ngStyle]="{background: color, opacity: visualStyleService.currentIndicatorOpacity}"></i> </div>
                      <div class="col-md-6 " *ngIf="visualStyleService.dynamicBrew[0].breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.dynamicBrew[0].breaks[i])}} &dash; &lt; {{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.dynamicBrew[0].breaks[i + 1])}}</div>
                      <div class="col-md-6 " *ngIf="! visualStyleService.dynamicBrew[0].breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.dynamicBrew[0].breaks[i])}}</div>
                      <div class="col-md-3 ">{{visualStyleService.featuresPerColorMap.get(color) || 0}}</div>
                    </div>
                   </div>
                </div>

                <!-- Static/Status legend items -->
                <div *ngIf="(exchangeData.selectedIndicator.indicatorType.includes('STATUS') && ! containsNegativeValues) && ! exchangeData.isMeasureOfValueChecked && ! exchangeData.isBalanceChecked">
         
                  <!-- zero -->
                  <div class="row" style="margin-right: 0px;" *ngIf="exchangeData.classifyZeroSeparately && containsZeroValues">
                    <div class="col-md-3"><i [ngStyle]="{background: env.defaultColorForZeroValues, opacity: visualStyleService.currentIndicatorOpacity}"></i></div>
                    <div class="col-md-6">0</div>
                    <div class="col-md-3">{{visualStyleService.featuresPerZero}}</div><br>
                  </div>	

                  <br />

                  <div [ngSwitch]="visualStyleService.classifyMethod">
                    <div *ngSwitchCase="'manual'">
                      <!-- manual classification -->
                      <div class="row" style="margin-right: 0px;" *ngFor="let color of visualStyleService.manualBrew?.colors; let i = index">
                        <div class="col-md-3 ">
                          <i [ngStyle]="{background: color, opacity: visualStyleService.currentIndicatorOpacity}">
                          </i> 
                        </div>
                        <div class="col-md-6 " *ngIf="visualStyleService.manualBrew.breaks[i + 1]" >
                          {{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.manualBrew.breaks[i])}} &dash; &lt; 
                          {{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.manualBrew.breaks[i + 1])}}
                        </div>
                        <div class="col-md-6 " *ngIf="! visualStyleService.manualBrew.breaks[i + 1]" >
                          {{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.manualBrew.breaks[i])}}
                        </div>
                        <div class="col-md-3 ">{{visualStyleService.featuresPerColorMap.get(color) || 0}}</div>
                      </div>
                    </div>
                    <div *ngSwitchDefault>
                      <!-- default values -->
                      <div class="row" style="margin-right: 0px;" *ngFor="let color of visualStyleService.defaultBrew?.colors; let i = index">
                        <div class="col-md-3 "><i [ngStyle]="{background: color, opacity: visualStyleService.currentIndicatorOpacity}"></i> </div>
                        <div class="col-md-6 " *ngIf="visualStyleService.defaultBrew.breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.defaultBrew.breaks[i])}} &dash; &lt; {{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.defaultBrew.breaks[i + 1])}}</div>
                        <div class="col-md-6 " *ngIf="! visualStyleService.defaultBrew.breaks[i + 1]" >{{dataExchangeService.getIndicatorValue_asFormattedText(visualStyleService.defaultBrew.breaks[i])}}</div>
                        <div class="col-md-3 ">{{visualStyleService.featuresPerColorMap.get(color) || 0}}</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div>
                  <br/>
                  <div *ngIf="exchangeData.allFeaturesRegionalMean && exchangeData.enableMeanDataDisplayInLegend">
                    <b>{{exchangeData.labelMean_regional}}</b>
                    {{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.allFeaturesRegionalMean)}}
                  </div>
                  <div *ngIf="exchangeData.allFeaturesMean && exchangeData.enableMeanDataDisplayInLegend && (exchangeData.configMeanDataDisplay == 'both' || (! exchangeData.allFeaturesRegionalMean && exchangeData.configMeanDataDisplay == 'preferRegionalMeanIfAvailable'))">
                    <b>{{exchangeData.labelMean}}</b>
                    {{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.allFeaturesMean)}}
                  </div>
                </div>
                <div id="kommonitorIndicatorClassification">
                  <div 
                  id="indicatorClassificationCollapse"
                  (click)="classificationCollapsed=!classificationCollapsed"
                  style="font-size:1.0em; cursor:pointer; margin-top: 16px;"
                  title="Klassifikation anpassen">
                  <span style="font-size:1.5em;" class="fas fa-cogs"></span> &nbsp; &nbsp;Klassifikation anpassen
                </div>
                <div [hidden]="classificationCollapsed" 
                  class="box boxedLegend with-border"
                  style="border-top: 1px solid #d2d6de; margin-top: 5px;">								
                  <div class="box-header with-border">
                    <h3 class="box-title">Klassifikation anpassen</h3>
                    <div class="box-tools pull-right">
                      <button type="button" class="close" (click)="classificationCollapsed=!classificationCollapsed">×</button>
                    </div>
                  </div>
                  <div class="box-body">
                    <kommonitor-classification-component></kommonitor-classification-component>
                  </div>
                </div>
                </div>
                
              </div>
            </div>
            <div class="tab-pane" id="legendTab2Content" role="tabpanel"
              aria-labelledby="legendTab2">

              <div class="just-padding">
                <h4>&Uuml;bersicht Metadaten</h4>
                <div id="indicatorMetadataOverview" text-align="center" align="center" class="">
      
                  <table class="table table-condensed">
                    <!-- <thead>
                              <tr>
                                <th>Name des Metadatums</th>
                                <th>Beschreibung des Metadatums</th>
                              </tr>
                            </thead> -->
                    <tbody>
                      <tr>
                        <td><b>Name</b></td>
                        <td>{{exchangeData.selectedIndicator.indicatorName}}</td>
                      </tr>
                      <tr>
                        <td><b>Kategorie</b></td>
                        <td
                          *ngIf="exchangeData.selectedIndicator.isHeadlineIndicator">
                          Leitindikator</td>
                        <td
                          *ngIf="!exchangeData.selectedIndicator.isHeadlineIndicator">
                          Basisindikator</td>
                      </tr>
                      <tr>
                        <td><b>Typ</b></td>
                        <td>{{exchangeData.selectedIndicator.indicatorType}}</td>
                      </tr>
                      <!-- we hide characteristicValue parameter as it is and old relic not used any longer. 
                              -> deprecated -->
        
                      <!-- <tr ng-if="exchangeData.selectedIndicator.characteristicValue">
                                <td><b>Merkmalsauspr&auml;gung</b></td>
                                <td>{{exchangeData.selectedIndicator.characteristicValue}}</td>
                              </tr> -->
                      <tr>
                        <td><b>Kennzeichen/K&uuml;rzel</b></td>
                        <td>{{exchangeData.selectedIndicator.abbreviation}}</td>
                      </tr>
                      <tr>
                        <td><b>Beschreibung</b></td>
                        <td
                          ng-bind-html="exchangeData.selectedIndicator.metadata.description">
                        </td>
                      </tr>
                      <tr>
                        <td><b>Maßeinheit</b></td>
                        <td>{{exchangeData.selectedIndicator.unit}}</td>
                      </tr>
                      <tr>
                        <td><b>Methodik</b></td>
                        <td
                          mathjax-bind="exchangeData.selectedIndicator.processDescription">
                        </td>
                      </tr>
                      <tr>
                        <td><b>Interpretation</b></td>
                        <td
                          ng-bind-html="exchangeData.selectedIndicator.interpretation">
                        </td>
                      </tr>
                      <tr>
                        <td><b>Datengrundlage</b></td>
                        <td
                          ng-bind-html="exchangeData.selectedIndicator.metadata.databasis">
                        </td>
                      </tr>
                      <tr>
                        <td><b>Datenquelle</b></td>
                        <td
                          ng-bind-html="exchangeData.selectedIndicator.metadata.datasource">
                        </td>
                      </tr>
                      <tr>
                        <td><b>Datenhalter und Kontakt</b></td>
                        <td
                          ng-bind-html="exchangeData.selectedIndicator.metadata.contact">
                        </td>
                      </tr>
                      <tr>
                        <td><b>Bemerkung</b></td>
                        <td
                          ng-bind-html="exchangeData.selectedIndicator.metadata.note">
                        </td>
                      </tr>
                      <tr>
                        <td><b>Fortführungsintervall</b></td>
                        <td
                          ng-bind-html="exchangeData.selectedIndicator.metadata.updateInterval">
                        </td>
                      </tr>
                    </tbody>
                  </table>
			
                </div>

                <hr>
                <br/>

                <div>
                  <h4>Verkn&uuml;pfte Indikatoren</h4>
                  <div *ngIf="!exchangeData.selectedIndicator.referencedIndicators || exchangeData.selectedIndicator.referencedIndicators.length==0">
                    -- keine --
                  </div>
                  <div *ngIf="exchangeData.selectedIndicator.referencedIndicators?.length > 0">
                    <div id="referencedIndicatorOverview" text-align="center" align="center" class=""
                    ng-if="exchangeData.selectedIndicator.referencedIndicators.length > 0">
          
                    <table class="table table-condensed">
                      <thead>
                        <tr>
                          <th>Name des Indikators</th>
                          <th>K&uuml;rzel/Kennziffer</th>
                          <th>Beschreibung der Verkn&uuml;pfung</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let indicator of exchangeData.selectedIndicator.referencedIndicators">
                          <td>{{indicator.referencedIndicatorName}}</td>
                          <td
                            ng-bind="exchangeData.getIndicatorAbbreviationFromIndicatorId(indicator.referencedIndicatorId)">
                          </td>
                          <td>{{indicator.referencedIndicatorDescription}}</td>
                        </tr>
                      </tbody>
                    </table>
          
                    </div>
                  </div>
                </div>
                
                <hr>
                <br/>

                <div>
                  <h4>Verkn&uuml;pfte Georessourcen</h4>
                  <div *ngIf="!exchangeData.selectedIndicator.referencedGeoresources || exchangeData.selectedIndicator.referencedGeoresources.length==0">
                    -- keine --
                  </div>
                  <div *ngIf="exchangeData.selectedIndicator.referencedGeoresources?.length > 0">
                    <div id="referencedGeoresourcesOverview" text-align="center" align="center" class=""
                    ng-if="exchangeData.selectedIndicator.referencedGeoresources.length > 0">
                    <h4>Verkn&uuml;pfte Georessourcen</h4>
          
                    <table class="table table-condensed">
                      <thead>
                        <tr>
                          <th>Name der Georessource</th>
                          <th>Beschreibung der Verkn&uuml;pfung</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let georesource of exchangeData.selectedIndicator.referencedGeoresources">
                          <td>{{georesource.referencedGeoresourceName}}</td>
                          <td>{{georesource.referencedGeoresourceDescription}}</td>
                        </tr>
                      </tbody>
                    </table>
          
                  </div>
                  </div>
                </div>
              </div>

            </div>
            <div class="tab-pane" id="legendTab3Content" role="tabpanel"
              aria-labelledby="legendTab3">

              
              <div class="just-padding">
                <table class="table table-condensed " style="margin-bottom:0px;">
                  <thead>
                    <tr>
                    <th>Datensatz</th>
                    <th>Layer Transparenz</th>
                    <th>Legende</th>
                    </tr>
                  </thead>

                  <tbody>

                    <!--  | filter:{isSelected:'true'} -->
                    <tr *ngFor="let dataset of keywordFilteredWmsDataset()">										
                      <td>
                        <label [innerHTML]="dataset.title">
                        </label>
                      </td>
                      <td>
                        <div class="form-group" align="center">
<!-- 
                          <input class=" input-sm" (value)="dataset.transparency" ng-init="dataset.transparency=0" (change)="dataExchangeService.adjustOpacityForWmsLayer(dataset, 1 - dataset.transparency);" type="range"  min="0" max="1" step="0.01">
 -->
                          <br/>

                          <label>{{dataset.transparency}}</label>
                        </div>
                      </td>
                      
                      <td class="text-center">
                        <img src="{{dataset.url}}service=WMS&REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&LAYER={{dataset.layerName}}">
                      </td>
                    </tr>

                  </tbody>
                </table>
              </div>	
            </div>
          </div>

        </div>
        <!-- /.box-body -->
      </div>
      <!-- /.box -->
  
      <div id="kommonitorStatisticalValues" class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">Indikatoren-Statistik</h3>
  
          <div class="box-tools pull-right">
            <button (click)="statisticCollapse.toggle()" id="statisticalValuesCollapse" type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa" [ngClass]="{'fa-plus':isStatisticCollapsed, 'fa-minus':!isStatisticCollapsed}"></i>
            </button>
          </div>
        </div>
        <div class="box-body" #statisticCollapse="ngbCollapse" [(ngbCollapse)]="isStatisticCollapsed">
          <em>Referenzzeitpunkt {{dataExchangeService.tsToDate_withOptionalUpdateInterval(dateAsDate, exchangeData.selectedIndicator.metadata.updateInterval)}}</em>
          <table id="statisticalValuesDisplayTable" class="table">
            <thead>
              <tr>
                <th></th>
                <th *ngIf="filterHelperService.filteredIndicatorFeatureIds.size == 0">{{exchangeData.labelAllFeatures}}</th>
                <th *ngIf="filterHelperService.filteredIndicatorFeatureIds.size > 0">{{exchangeData.labelFilteredFeatures}}</th>
                <th>{{exchangeData.labelSelectedFeatures}}</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{exchangeData.labelNumberOfFeatures}}</td>
                <td>{{exchangeData.allFeaturesNumberOfFeatures}}</td>
                <td>{{exchangeData.selectedFeaturesNumberOfFeatures}}</td>
              </tr>
              <tr *ngIf="! exchangeData.allFeaturesRegionalSum">
                <td>{{exchangeData.labelSum}}</td>
                <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.allFeaturesSum)}}</td>
                <td>{{exchangeData.selectedFeaturesSum}}</td>
              </tr>
              <tr *ngIf="exchangeData.allFeaturesRegionalSum">
                <td>{{exchangeData.labelSum_regional}}</td>
                <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.allFeaturesRegionalSum)}}</td>
                <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.selectedFeaturesSum)}}</td>
              </tr>
              
              
                 <tr *ngIf="exchangeData.allFeaturesRegionalMean">
                  <td>{{exchangeData.labelMean_regional}}</td>
                  <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.allFeaturesRegionalMean)}}</td>
                  <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.selectedFeaturesMean)}}</td>
                </tr>
                <tr *ngIf="exchangeData.allFeaturesMean && (exchangeData.configMeanDataDisplay == 'both' || (! exchangeData.allFeaturesRegionalMean && exchangeData.configMeanDataDisplay == 'preferRegionalMeanIfAvailable'))">
                  <td>{{exchangeData.labelMean}}</td>
                  <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.allFeaturesMean)}}</td>
                   <td>{{exchangeData.selectedFeaturesMean}}</td>
                </tr>
                 
                 <tr>
                   <td>{{exchangeData.labelMin}}</td>
                   <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.allFeaturesMin)}}</td>
                <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.selectedFeaturesMin)}}</td>
                 </tr>
              <tr>
                <td>{{exchangeData.labelMax}}</td>
                   <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.allFeaturesMax)}}</td>
                <td>{{dataExchangeService.getIndicatorValue_asFormattedText(exchangeData.selectedFeaturesMax)}}</td>
              </tr>
  
              <tr>
                <td>{{exchangeData.labelSpatiallyUnassignable_regional}}</td>
                   <td>{{exchangeData.allFeaturesRegionalSpatiallyUnassignable || "-"}}</td>
                <td>-</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- /.box-body -->
      </div>
      <!-- /.box -->

</div>